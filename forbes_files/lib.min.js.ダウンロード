!function(){window.DCTMTAG=window.DCTMTAG||[],window.DCTMTAG.events=window.DCTMTAG.events||{custom:{}},window.dcDataStorage=Array.isArray(window.dcDataStorage)&&window.dcDataStorage||[],DCTMTAG.debug=DCTMTAG.debug||!1;var c,l,p,f,g,d,r,h,a,u=window.DCTMTAG.shift();function i(e){r(e);for(var t=e.tags,n=[],a=[],i=0;i<t.length;i++)t[i].survey?(t[i].triggers={group_id:{0:{conditions:[{item_name:"freq_repeat",item_value:["1440"],operator:"eq"}]}}},c.triggers.compareItems(t[i])?(h("Tag Trigger: tag_id:"+t[i].id+" is pushed survey List"),a.push(t[i])):(h("Tag Trigger: tag_id:"+t[i].id+" is excluded by trigger."),n.push(t[i].id))):t[i].event&&c.queue[t[i].event.type]?"custom"==t[i].event.type||c.triggers.compareItems(t[i])?(h("Tag Trigger: tag_id:"+t[i].id+" is pushed ["+t[i].event.type+"] queue."),c.queue[t[i].event.type].push(t[i])):(h("Tag Trigger: tag_id:"+t[i].id+" is excluded by trigger."),n.push(t[i].id)):(h(
"Tag Trigger: tag_id:"+t[i].id+" is excluded because event type that does not exist."),n.push(t[i].id));h("Tag Trigger: Excluded tag_id List : ["+n.join(", ")+"]");for(i=0;i<c.queue.start.length;i++)h("Tag Event: start, tag_id:"+c.queue.start[i].id),g(c.queue.start[i],document);switch(h("ReadyState: "+document.readyState),document.readyState){case"loading":window.addEventListener("DOMContentLoaded",c.event.dom),window.addEventListener("load",c.event.onload);break;case"interactive":window.addEventListener("load",c.event.onload);for(i=0;i<c.queue.dom.length;i++)h("Tag Event: INSERT[dom]_interactive, tag_id: "+c.queue.dom[i].id),g(c.queue.dom[i],document);for(i=0;i<c.queue.value.length;i++)c.event.value(c.queue.value[i]);break;case"complete":for(i=0;i<c.queue.dom.length;i++)h("Tag Event: INSERT[dom]_complete, tag_id: "+c.queue.dom[i].id),g(c.queue.dom[i],document);for(i=0;i<c.queue.value.length;i++)c.event.value(c.queue.value[i]);for(i=0;i<c.queue.onload.length;i++)h(
"Tag Event: INSERT[onload]_complete,  tag_id: "+c.queue.onload[i].id),g(c.queue.onload[i],document)}0<c.queue.custom.length&&c.event.customEventInit(),0<a.length&&f.init(a)}function n(e){var t,n="https://"+u.server+"/post/"+u.acid;a(u.acid)?window.fetch?(h("API Request: Fetch, id: "+u.acid+", Body:"+e),fetch(n,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/x-www-form-urlencoded; charset=utf-8","Accept-Encoding":"gzip"},body:e,mode:"cors",credentials:"include"}).then(function(e){if(200==e.status)return e.json();throw new Error("Error Response - Response.status:"+e.status)}).then(function(e){i(e)}).catch(function(e){h("API Response: "+e.message)})):(h("API Request: XMLHttpRequest, id: "+u.acid+", Body:"+e),(t=new XMLHttpRequest).onreadystatechange=function(){4==this.readyState&&200==this.status&&i(JSON.parse(this.responseText))},t.withCredentials=!0,t.open("POST",n,!0),t.setRequestHeader("Accept","application/json"),t.setRequestHeader("Content-Type",
"application/x-www-form-urlencoded; charset=utf-8"),t.setRequestHeader("Accept-Encoding","gzip"),t.send(e)):h("API Request: Error, Abort this request - Incorrect ID: "+u.acid)}void 0!==u&&(u.surveyCSSPath||(u.surveyCSSPath="s.dc-tag.jp/css/survey.min.css"),u.surveyControlPath||(u.surveyControlPath="sv.dc-tag.jp/control"),u.surveyAnswerPath||(u.surveyAnswerPath="sv.dc-tag.jp/answer"),(c={queue:{start:[],onload:[],dom:[],value:[],custom:[]}}).event={onload:function(){if(0<c.queue.onload.length)for(var e=0;e<c.queue.onload.length;e++)h("Tag Event: INSERT[onload]_event, tag_id:"+c.queue.onload[e].id),g(c.queue.onload[e],document)},dom:function(){if(0<c.queue.dom.length)for(var e=0;e<c.queue.dom.length;e++)h("Tag Event: INSERT[dom]_event, tag_id:"+c.queue.dom[e].id),g(c.queue.dom[e],document);if(0<c.queue.value.length)for(e=0;e<c.queue.value.length;e++)c.event.value(c.queue.value[e])},value:function(e){h(
"Tag Event: WaitValue, tag_id:"+e.id+", target:"+e.event.target+", timeout:"+e.event.timeout),function r(s,o,d,u){return function(){var e=d.split("."),t=void 0,n="window",a=r(s+1,o,d,u);"window"===e[0]&&e.shift();for(var i=0;i<e.length;i++){n+="."+e[i];try{t=Function("'use strict';return ("+n+")")()}catch(e){h("Tag Event: WaitValue, tag_id:"+o.id+", valueError"+n),t=void 0}if(!t)break}h("Tag Event: WaitValue, tag_id:"+o.id+", value:"+s+" times "+t),t?(h("Tag Event: WaitValue, tag_id:"+o.id+" Fire"),g(o,document)):s<u[1]?setTimeout(a,u[0]):s>=u[1]&&u[2]?(h("Tag Event: WaitValue, tag_id:"+o.id+" Timeout-true"),g(o,document)):h("Tag Event: WaitValue, tag_id:"+o.id+" Timeout-false")}}(0,e,Array.isArray(e.event.target)?e.event.target[0]:e.event.target,e.event.timeout)()},custom:function(e){var t;2<e.event.target.length?(t=e.event.target.slice(2),h("Tag Event: WaitValue, tag_id:"+e.id+", target:"+e.event.target+", timeout:"+e.event.timeout),c.event.checkVarExistsArray(0,e,t,e.event.timeout)(
)):2==e.event.target.length&&g(e,document)},checkVarExistsArray:function(s,o,d,u){return function(){for(var t=Array(d.length),e=c.event.checkVarExistsArray(s+1,o,d,u),n=0;n<d.length;n++){var a="window",i=d[n].split(".");"window"===i[0]&&i.shift();for(var r=0;r<i.length;r++){a+="."+i[r];try{t[n]=Function("'use strict';return ("+a+")")()}catch(e){h("Tag Event: WaitValue, tag_id:"+o.id+", valueError"+a),t[n]=void 0}if(!t[n])break}}h("Tag Event: WaitValue, tag_id:"+o.id+", value:"+s+" times "+t),t.every(function(e){return Boolean(e)})?(h("Tag Event: WaitValue, tag_id:"+o.id+" Fire"),g(o,document)):s<u[1]?setTimeout(e,u[0]):s>=u[1]&&u[2]?(h("Tag Event: WaitValue, tag_id:"+o.id+" Timeout-true"),g(o,document)):h("Tag Event: WaitValue, tag_id:"+o.id+" Timeout-false")}},customEventInit:function(){var e=window.dcDataStorage;dcDataStorage=[];var t=dcDataStorage;DCTMTAG.events.custom[u.acid]=function(e){if("string"!=typeof e)return!1;var t=!1;l.setFqProfile();for(
var n=0;n<c.queue.custom.length;n++){var a=c.queue.custom[n];a&&a.event&&Array.isArray(a.event.target)&&e===a.event.target[0]&&(t=!0,c.triggers.compareItems(a)?0===a.event.target[1]?h("Tag Event: INSERT_REJECTED[custom], tag_id:"+a.id+", The insert limit has been reached."):(h("Tag Event: INSERT[custom], tag_id:"+a.id+", eventName:"+a.event.target[0]+", limit:"+a.event.target[1]),c.event.custom(a)):h("Tag Trigger: tag_id:"+a.id+" is excluded by trigger."))}return t||h("Tag Event: TAG_NOT_EXIST[custom], eventName:"+e),!0},t.push=function(){var e=[].slice.call(arguments,0),t=!1;h("Tag Event: EVENT_PUSH, "+JSON.stringify(e));for(var n=0;n<e.length;n++){var a,i=e[n].container_id;for(a in DCTMTAG.events.custom)(void 0===i||i==a)&&(t=DCTMTAG.events.custom[a](e[n].event))}t||h("Tag Event: CONTAINER_NOT_EXIST[custom], container_id:"+i)};for(var n=0;n<e.length;n++)(void 0===e[n].container_id||e[n].container_id==u.acid)&&t.push(e[n])}},c.triggers={compareItems:function(i){function e(e){if(
!e.hasOwnProperty("conditions"))return 1;for(var t=0;t<e.conditions.length;t++)if(c.triggers.operator[e.conditions[t].operator]&&c.triggers.item[e.conditions[t].item_name]){var n=e.conditions[t].operator;-1<c.triggers.frequencyItems.indexOf(e.conditions[t].item_name)&&(n="jsfq");var a=c.triggers.operator[n](c.triggers.item[e.conditions[t].item_name](e.conditions[t],i),e.conditions[t].item_value);if(h("Tag Trigger: ----"+e.conditions[t].item_name+" <"+n+"> "+e.conditions[t].item_value.join(",")+": "+a),0==a)return}return 1}if(h("Tag Trigger: tag_id:"+i.id+" :"),!(i.triggers&&i.triggers.group_id&&0<Object.keys(i.triggers.group_id).length))return!0;if(i.triggers.group_id.hasOwnProperty("0")){if(h("Tag Trigger: --group_0:"),!e(i.triggers.group_id[0]))return!1;if(1===Object.keys(i.triggers.group_id).length)return!0}for(var t in i.triggers.group_id)if("0"!==t&&i.triggers.group_id.hasOwnProperty(t)&&(h("Tag Trigger: --group_"+t+":"),e(i.triggers.group_id[t])))return!0;return!1},item:{
freq_all:function(e,t){return!(l.isExcludeID(t.id)||!p.initParam.enablecookie)&&(l.setTags[t.id]={},l.setTags[t.id].type=e.item_name,l.setTags[t.id].value=e.item_value[0],!0)},freq_daycount:function(e,t){return c.triggers.item.freq_all(e,t)},freq_1day:function(e,t){return c.triggers.item.freq_all(e,t)},freq_repeat:function(e,t){return c.triggers.item.freq_all(e,t)},url:function(){return location.href}},operator:{eq:function(e,t){return e==t[0]},jsfq:function(e){return e}},frequencyItems:["freq_daycount","freq_1day","freq_repeat"]},l={FQ_COOKIE:"_dctagfq",MAX_DAYS:10,MAX_TIMES:9,MAX_MINUTES:14400,MAX_TAGS:44,EXPIRE_SEC:864e3,tagInfos:{},setTags:{},excludeTags:[],setTagFq:function(e){if(l.setTags.hasOwnProperty(e)){var t=l.setTags[e];switch(h("FQ SET: tag_id:"+e+", param:"+JSON.stringify(t)),t.type){case"freq_daycount":l._dctag_fq_days(t.value,e);break;case"freq_1day":l._dctag_fq_times(t.value,e);break;case"freq_repeat":l._dctag_fq_minutes(t.value,e)}}},isExcludeID:function(e){
return-1<l.excludeTags.indexOf(e)},_cookieGetItem:function(e){var t=document.cookie,e=new RegExp("(?:^|.*;\\s*)"+escape(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*((?:[^;](?!;))*[^;]?).*");return e.test(t)?unescape(t.replace(e,"$1")):""},_cookieSetTagInfos:function(){var e=new Date;e.setSeconds(e.getSeconds()+l.EXPIRE_SEC);var t,n=[];for(t in l.tagInfos){var a=l.tagInfos[t],i=a[0],r=a[1],a=a[2];n.push(t+":"+i+"."+r+"."+a)}e=l.FQ_COOKIE+"="+n.join("|")+"; path=/; expires="+e.toUTCString();document.cookie=e,h("FQ SET: updateFqCookie, "+e)},_cookieGetTagInfos:function(){var e=l._cookieGetItem(l.FQ_COOKIE);if(void 0===e)return{};for(var t=parseInt((new Date).getTime()/1e3),n=new RegExp("(\\d+?):(\\d+?)\\.(\\d)\\.(\\d)"),a={},i=e.split("|"),r=0;r<i.length;r++){var s,o,d,u,c=n.exec(i[r]);null!=c&&(s=parseInt(c[1]),o=parseInt(c[2]),d=parseInt(c[3]),u=parseInt(c[4]),0<(c=o-t)?(a[s]=[o,d,u],h("FQ GET: IsValid, tag_id:"+s+", count:"+u+"/"+d+", diffSec:"+c+", diffDays:"+(c/86400).toFixed(1))
):h("FQ GET: Expired, tag_id:"+s+", count:"+u+"/"+d+", diffSec:"+c+", diffDays:"+(c/86400).toFixed(1)))}return a},setFqProfile:function(){l.tagInfos=l._cookieGetTagInfos();var e,t=[];for(e in l.tagInfos){var n=l.tagInfos[e][1],a=l.tagInfos[e][2];(0==n||0<n&&n<=a)&&t.push(parseInt(e))}l.excludeTags=t,h("FQ GET: Excluded tag_id List: ["+l.excludeTags.join(",")+"]")},getTagFq:function(e){e=l.tagInfos[e];return void 0===e?[0,0,0]:e},updateTagFq:function(e,t,n,a){l.tagInfos=l._cookieGetTagInfos();var i=parseInt(t.getTime()/1e3),t=Object.keys(l.tagInfos).length;h("FQ SET: updateFq, tag_id:"+e+", tms:"+i+", maxCount:"+n+", curCount:"+a+", currentKeyLength:"+t),t>l.MAX_TAGS&&void 0===l.tagInfos[e]?h("FQ SET: WARNING, "+t+" << The ID limit has been exceeded."):(l.tagInfos[e]=[i,n,a],l._cookieSetTagInfos())},dateLineTm:function(){var e=new Date;return e.setHours(23),e.setMinutes(59),e.setSeconds(59),e},_dctag_fq_days:function(e,t){var n=l.dateLineTm(),e=parseInt(e);n.setDate(n.getDate()+e-1),
l.updateTagFq(t,n,0,0)},_dctag_fq_times:function(e,t){var n=l.dateLineTm(),a=l.getTagFq(t)[2]+1,e=parseInt(e);e>l.MAX_TIMES&&(e=l.MAX_TIMES),l.updateTagFq(t,n,e,a)},_dctag_fq_minutes:function(e,t){var n=new Date,e=parseInt(e);n.setMinutes(n.getMinutes()+e),l.updateTagFq(t,n,0,0)}},p={initParam:{},isFirstPartyCookie:function(){var e,t=!1;return navigator.cookieEnabled&&void 0!==document.cookie&&(e="dctm_cookiecheck=1",document.cookie=e,t=0<document.cookie.length&&-1<document.cookie.indexOf(e),document.cookie=e+";expires="+new Date(0).toUTCString()),t},getMetadata:function(e){try{var t=e.toLowerCase(),n=e.toUpperCase(),a=e[0].toUpperCase()+e.slice(1).toLowerCase(),i=document.head.children||{},r=i[t]||i[n]||i[a],s="";r&&(s=r.getAttribute("content"))}catch(e){h("Error: getMetadata, "+e.name+": "+e.message);s=""}return s},getCookieValue:function(e){var t=document.cookie;if(t)for(var n=t.split("; "),a=0,i=n.length;a<i;a++)if((t=n[a].split("="))[0]===e)return t[1]},isMobileDevice:function(){
return!(!navigator.userAgent||!/android.+mobile|ipod|iphone/.test(navigator.userAgent.toLowerCase()))||!(!navigator.userAgentData||!navigator.userAgentData.mobile)},getParam:function(){var e={};return e.url=window.location.href,e.domain_name=document.domain,e.referrer=document.referrer,e.protocol=window.location.protocol.slice(0,-1),e.title=document.title||"",e.description=p.getMetadata("description"),e.enablecookie=p.isFirstPartyCookie(),e}},f={baseElementID:"dctmSurveyMain",elementPrefix:"dctmSurvey",init:function(e){f.getDisplayItem(e.sort(function(e,t){return t.survey.priority-e.survey.priority}))},getDisplayItem:function(t){if(t.length<1)return h("SURVEY: No target item."),!1;var n=t.shift(),e={survey_id:n.survey.id},a="https://"+u.surveyControlPath;n.survey&&n.survey.id?d(a,JSON.stringify(e),function(e){!e.answered&&e.answer_count<n.survey.answers_limit?f.createSurvey(n):(l.setTagFq(n.id),f.getDisplayItem(t))}):h("API Request: Error, Abort this request - surveyItem undefined")},
displayAlert:function(e){var t=f.elementPrefix;e.target.validity&&e.target.validity.valid||"SELECT"===e.target.tagName&&""!==e.target.value?this.msgElement.classList.add(t+"NotDisplay"):this.msgElement.classList.remove(t+"NotDisplay")},checkValidation:function(e){var t=[];for(var n=0;n<e.length;n++)t.push(function(e,t){var n=f.elementPrefix,a=e.querySelectorAll(":invalid"),e=e.getElementsByClassName(n+"invalidMsg")[0];if(0<a.length)return e.classList.remove(n+"NotDisplay"),t;e.classList.add(n+"NotDisplay")}(e[n],n));return!(0<(t=t.filter(function(e){return"number"==typeof e})).length)||(document.getElementById(f.elementPrefix+"Content").scrollTop=e[t[0]].offsetTop,!1)},sendResult:function(e){if(e.preventDefault(),!f.checkValidation(this.surveyItemList))return!1;var t={};t.survey_id=this.survey_id,t.td_client_id=p.getCookieValue("_td");for(var n=[],a=0;a<this.surveyTagText.survey_items.length;a++){var i=this.surveyItemList[a].getElementsByClassName(f.elementPrefix+"Answer_"+Number(a+1))
;switch(this.surveyTagText.survey_items[a].type){case"short":case"string":o=i[0].value;break;case"pulldown":for(var r=i[0].getElementsByTagName("option"),s=0;s<r.length;s++)r[s].selected&&(o=r[s].text);break;case"radio":case"checkbox":for(var o={},s=0;s<this.surveyTagText.survey_items[a].items.length;s++)o[i[s].value]=Number(i[s].checked)}n.push(o)}t.answer=n;e="https://"+u.surveyAnswerPath;d(e,JSON.stringify(t),function(){h("API Request: Success - Send survey answer")}),f.toggleDisplay(document.getElementById(f.baseElementID),"answered",this.tag_id)},createForm:function(e,t){var n=f.elementPrefix,a=n+"Answer_",i={short:"このフィールドを入力してください。",string:"このフィールドを入力してください。",pulldown:"プルダウンから１つ選択してください。",radio:"１つ選択してください。",checkbox:"当てはまるものを全て選択してください。"},r=document.createElement("div");r.className=n+"FormWrap";var s=[];switch(s.push("<p>"+t.description),t.mandatory&&s.push('<span class="',n,'MandatoryMsg">　※必須</span>'),s.push("</p>"),t.type){case"short":s.push(["<input ",'id="',a,e,'" ',
'class="',a,e,'" ','type="text"','name="',a,e,'" ','maxlength="15"'].join("")),t.mandatory&&s.push(" required"),s.push(">"),s.push(['<span class="',n,"invalidMsg"," ",n,'NotDisplay">',i[t.type],"</span>"].join("")),s.push(['<p class="',n,'StringLimit">',"15文字以内","</p>"].join(""));break;case"string":s.push(["<textarea ",'id="',a,e,'" ','class="',a,e,'" ','name="',a,e,'" ','rows="5" ','cols="33" ','maxlength="80"'].join("")),t.mandatory&&s.push(" required"),s.push("></textarea>"),s.push(['<span class="',n,"invalidMsg"," ",n,'NotDisplay">',i[t.type],"</span>"].join("")),s.push(['<p class="',n,'StringLimit">',"80文字以内","</p>"].join(""));break;case"pulldown":s.push(["<select ",'name="',a,e,'" ','id="',a,e,'"'].join("")),window.CSS&&(window.CSS.supports("-webkit-appearance: none")||window.CSS.supports("appearance: none"))?s.push('class="',a,e," ",n,'PullDownParts" '):s.push('class="',a,e,'" '),t.mandatory&&s.push(" required"),s.push(">"),s.push(
'<option value="" disabled selected>選択してください。</option>');for(var o=0;o<t.items.length;o++)s.push(["<option ",'value="',o,'" ','class="',a,e,'">',t.items[o].value,"</option>"].join(""));s.push("</select>"),s.push(['<span class="',n,"invalidMsg"," ",n,'NotDisplay">',i[t.type],"</span>"].join(""));break;case"radio":for(o=0;o<t.items.length;o++)s.push("<div>"),s.push(["<input ",'type="radio" ','class="',a,e,'" ','id="',a,e,"_",o+1,'" ','name="',a,e,'" ','value="',t.items[o].value,'"'].join("")),t.mandatory&&s.push(" required"),s.push(">"),s.push(["<label ",'for="',a,e,"_",o+1,'" ','class="',n,'RadioLabel">',t.items[o].value,"</label>"].join("")),s.push("</div>");s.push(['<span class="',n,"invalidMsg"," ",n,'NotDisplay">',i[t.type],"</span>"].join(""));break;case"checkbox":for(o=0;o<t.items.length;o++)s.push("<div>"),s.push(["<input ",'type="checkbox" ','class="',a,e,'" ','id="',a,e,"_",o+1,'" ','name="',a,e,'"  ','value="',t.items[o].value,'">'].join("")),s.push(["<label ",'for="',
a+e+"_"+(o+1)+'" ','class="',n,'SelectLabel">',t.items[o].value,"</label>"].join("")),s.push("</div>");s.push(["<input ",'type="checkbox" ','class="',a,e,"_check ",,n,'MandatoryCheck" ','id="',a,e,'_check" ','name="',a,e,'" ','value=""'].join("")),t.mandatory&&s.push(" required"),s.push(">"),s.push(['<span class="',n,"invalidMsg"," ",n,'NotDisplay">',i[t.type],"</span>"].join(""))}return r.insertAdjacentHTML("afterbegin",s.join("")),r},checkboxControl:function(e){var t=document.getElementById(f.elementPrefix+"Main"),n=t.getElementsByClassName(e.target.className),a=t.getElementsByClassName(e.target.className+"_check")[0],t=e.target.checked;if(t)for(var i=0;i<n.length;i++)(this.exclude||this.targetSurvey.items[i].exclude)&&(n[i].checked=!1);if(e.target.checked=t,this.targetSurvey.mandatory){a.checked=!1;for(i=0;i<n.length;i++)n[i].checked&&(a.checked=!0);a.dispatchEvent(this.statusChangeEvent)}},toggleDisplay:function(e,t,n){var a=f.elementPrefix+"Open",i=f.elementPrefix+"Close",
r=f.elementPrefix+"Visible";"open"===t?(e.classList.remove(i),e.classList.add(a)):"answered"===t?(e.classList.remove(a),e.classList.add(i),e.getElementsByClassName("dctmSurveyHead")[0].children[0].innerHTML="<span>ご協力</span><span>ありがとうございます</span>",window.setTimeout(function(){e.classList.remove(r),window.setTimeout(function(){e.remove?e.remove():e.parentNode.removeChild(e)},1e3)},1e3),n&&l.setTagFq(n)):"cancel"===t&&(e.classList.remove(r),window.setTimeout(function(){e.remove?e.remove():e.parentNode.removeChild(e)},1e3),n&&l.setTagFq(n))},loadCSS:function(e){for(var t="https://"+u.surveyCSSPath,n=document.getElementsByTagName("link"),a=0;a<n.length;a++)if(t==n[a].href)return h("SURVEY: loadCSS, SurveyCSS is already loaded."),e.style.display="",!1;var i=document,r=i.createElement("link");r.href=t,r.rel="stylesheet",r.type="text/css",r.onload=function(){e.style.display=""},r.onerror=function(){h("SURVEY: loadCSS, ERROR")},i.getElementsByTagName("head")[0].appendChild(r)},
createSurvey:function(e){var t=e.survey,n=JSON.parse(e.tag_text),a=[],i=document.createElement("div");i.id=f.baseElementID,i.style.display="none",f.loadCSS(i);var r=f.elementPrefix;p.isMobileDevice()?i.classList.add(r+"SP"):i.classList.add(r+"PC");var s=p.isMobileDevice()?n.display_type.sp:n.display_type.pc;h(["SURVEY: survey_id=",t.id,", isMobileDevice=",p.isMobileDevice(),", displayType=",s].join(""));var o=['<div id="',r,'Container">','<div class="',r,'Head">',"<p><span>アンケートに</span><span>ご協力ください</span></p>",'<div class="',r,'CloseBtn"></div>',"</div>",'<div id="',r,'Content">','<div id="',r,'ContentInner">','<form action="" method="post" class="',r,'FormArea">','<div id="',r,'SendWrapper">',"<p>","ご回答いただいた情報の取り扱いに関しては<br>",'<a href="',t.policy_url,'" target="_blank">こちら</a>',"をご確認ください。","</p>","<button>送信</button>","</div></form></div></div></div>"].join("");i.insertAdjacentHTML("afterbegin",o),"banner"==s?(i.classList.add(r+"Close"),i.getElementsByClassName(r+"Head"
)[0].addEventListener("click",{tag_id:e.id,handleEvent:function(e){f.toggleDisplay(i,"open",this.tag_id)}},{once:!0})):"popup"==s&&i.classList.add(r+"Open");for(var d=0;d<n.survey_items.length;d++){var u,c=i.getElementsByClassName(r+"FormArea")[0].insertBefore(f.createForm(d+1,n.survey_items[d]),i.getElementsByClassName(r+"FormArea")[0].lastChild);if("checkbox"==n.survey_items[d].type){document.documentMode?(u=document.createEvent("Event")).initEvent("change",!0,!0):u=new Event("change",{bubbles:!0,cancelable:!0});for(var l=0;l<n.survey_items[d].items.length;l++)c.getElementsByTagName("input")[l].addEventListener("change",{targetSurvey:n.survey_items[d],exclude:n.survey_items[d].items[l].exclude,statusChangeEvent:u,handleEvent:f.checkboxControl})}for(var g=c.querySelectorAll(":invalid"),l=0;l<g.length;l++){var v={msgElement:c.getElementsByClassName(r+"invalidMsg")[0],handleEvent:f.displayAlert};g[l].addEventListener("change",v)}a.push(c)}function m(){if(
document.body&&document.getElementById(f.baseElementID))return h("SURVEY: insertElement, Another survey has been displayed."),!1;document.body.insertBefore(i,null),window.setTimeout(function(){i.classList.add(r+"Visible")},100)}i.getElementsByClassName(r+"CloseBtn")[0].addEventListener("click",{tag_id:e.id,handleEvent:function(e){e.stopPropagation(),f.toggleDisplay(i,"cancel",this.tag_id)}}),i.getElementsByTagName("button")[0].addEventListener("click",{tag_id:e.id,survey_id:t.id,surveyTagText:n,surveyItemList:a,handleEvent:f.sendResult}),"loading"==document.readyState?window.addEventListener("DOMContentLoaded",m):m()}},g=function(e,t){var n,a,d;t.body?(n=e.tag_text||"",a=e.id,l.setTagFq(a),"custom"==e.event.type&&"number"==typeof e.event.target[1]&&0<e.event.target[1]&&e.event.target[1]--,d=function(e,t){t&&(e.addEventListener?e.onload=t:e.onreadystatechange=function(){e.readyState in{loaded:1,complete:1}&&(e.onreadystatechange=null,t())})},function a(i,r,s,o){return function(){try{if(
0<r.length){var e=r.shift(),t=a(i,r,s,o);if("SCRIPT"==String(e.nodeName.toUpperCase()))!function(e,t,n){var a=document.createElement("script");a.async=!1,a.type="text/javascript",a.id=t.id,a.text=t.text||t.textContent||t.innerHTML||"",t.charset&&(a.charset=t.charset),(t=t.getAttribute("src"))&&(a.src=t,d(a,n)),e.insertBefore(a,null),t||n()}(i,e,t);else if(e.innerHTML&&0<=e.innerHTML.toLowerCase().indexOf("<script")){for(var n=[];e.firstChild;)n.push(e.removeChild(e.firstChild));i.insertBefore(e,null),a(e,n,t,o)()}else i.insertBefore(e,null),t()}else s()}catch(e){h("Error: insertTag, "+e.name+": "+e.message),window.setTimeout(o,0)}}}(t.body,function(e){(t=document.createElement("div")).innerHTML="tx<div>"+e+"</div>";for(var t=t.lastChild,n=[];t.firstChild;)n.push(t.removeChild(t.firstChild));return n}(n),function(){},function(){})()):window.setTimeout(function(){h("Waiting <body>: start, tag_id:"+e.id),g(e,t)},200)},d=function(e,t,n){var a;window.fetch?(h("API Request: Fetch, Body:"+t),
fetch(e,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/x-www-form-urlencoded; charset=utf-8","Accept-Encoding":"gzip"},body:t,mode:"cors",credentials:"include"}).then(function(e){if(200==e.status)return e.json();throw new Error("Error Response - Response.status:"+e.status)}).then(function(e){n(e)}).catch(function(e){h("API Response: "+e.message)})):(h("API Request: XMLHttpRequest, Body:"+t),(a=new XMLHttpRequest).onreadystatechange=function(){var e;4==this.readyState&&200==this.status&&(e=JSON.parse(this.responseText),n(e))},a.withCredentials=!0,a.open("POST",e,!0),a.setRequestHeader("Accept","application/json"),a.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=utf-8"),a.setRequestHeader("Accept-Encoding","gzip"),a.send(t))},r=function(e){if(!u.debug)return!1;var t=e.tags||[];h("TAG LIST [length: "+t.length+"] :");for(var n=0;n<t.length;n++){var a=t[n],i="";try{a.survey?i=["--tag_id:",String(a.id),"[survey],"," survey_id:",
a.survey.id," priority:",a.survey.priority," answers_limit:",a.survey.answers_limit].join(""):160<(i=["--tag_id:",String(a.id),"[",a.event.type,"],"," tag:",a.tag_text.replace(/\n/g,"")].join("")).length&&(i=i.substr(0,160)+" ...")}catch(e){i=["ERROR tagInfoMassage: ",e.message].join("")}h(i)}},h=function(e){if(!u.debug)return!1;var t="[DCTAG-LOG:"+(new Date).getTime()+":"+u.acid+"]";console.log(t,String(e))},a=function(e){var t=RegExp("[0-9]+");return!(!e||!t.test(e))},function(){try{-1<window.location.search.indexOf("dctagdebugmode")&&(u.debug=!0),!0===u.debug&&h("START DEBUG MODE"),l.setFqProfile(),p.initParam=p.getParam();var e=new Blob([JSON.stringify(p.initParam)]),t=new FileReader;t.onload=function(e){n((e=e&&e.srcElement)?e.result.substr(e.result.indexOf(",")+1):"")},t.readAsDataURL(e)}catch(e){h("Error: init, "+e.name+": "+e.message),n("")}}())}();