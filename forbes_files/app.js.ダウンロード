!function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}function runTimeout(fun){if(cachedSetTimeout===setTimeout)return setTimeout(fun,0);if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout)return cachedSetTimeout=setTimeout,setTimeout(fun,0);try{return cachedSetTimeout(fun,0)}catch(e){try{return cachedSetTimeout.call(null,fun,0)}catch(e){return cachedSetTimeout.call(this,fun,0)}}}function runClearTimeout(marker){if(cachedClearTimeout===clearTimeout)return clearTimeout(marker);if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout)return cachedClearTimeout=clearTimeout,clearTimeout(marker);try{return cachedClearTimeout(marker)}catch(e){try{return cachedClearTimeout.call(null,marker)}catch(e){return cachedClearTimeout.call(this,marker)}}}function cleanUpNextTick(){draining&&currentQueue&&(draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue())}function drainQueue(){if(!draining){var timeout=runTimeout(cleanUpNextTick);draining=!0;for(var len=queue.length;len;){for(currentQueue=queue,queue=[];++queueIndex<len;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,len=queue.length}currentQueue=null,draining=!1,runClearTimeout(timeout)}}function Item(fun,array){this.fun=fun,this.array=array}function noop(){}var cachedSetTimeout,cachedClearTimeout,process=module.exports={};!function(){try{cachedSetTimeout="function"==typeof setTimeout?setTimeout:defaultSetTimout}catch(e){cachedSetTimeout=defaultSetTimout}try{cachedClearTimeout="function"==typeof clearTimeout?clearTimeout:defaultClearTimeout}catch(e){cachedClearTimeout=defaultClearTimeout}}();var currentQueue,queue=[],draining=!1,queueIndex=-1;process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)args[i-1]=arguments[i];queue.push(new Item(fun,args)),1!==queue.length||draining||runTimeout(drainQueue)},Item.prototype.run=function(){this.fun.apply(null,this.array)},process.title="browser",process.browser=!0,process.env={},process.argv=[],process.version="",process.versions={},process.on=noop,process.addListener=noop,process.once=noop,process.off=noop,process.removeListener=noop,process.removeAllListeners=noop,process.emit=noop,process.binding=function(name){throw new Error("process.binding is not supported")},process.cwd=function(){return"/"},process.chdir=function(dir){throw new Error("process.chdir is not supported")},process.umask=function(){return 0}},{}],2:[function(require,module,exports){(function(process){"use strict";function main(){function debug(){if(cookie.get("DEBUG")){for(var _len=arguments.length,args=Array(_len),_key=0;_len>_key;_key++)args[_key]=arguments[_key];return console&&console.info&&console.info("[DEBUG] "+args.join(","))}}function warn(){var _console;return console&&console.warn&&(_console=console).warn.apply(_console,arguments)}function checkElement(elem){return elem?!!elem.getBoundingClientRect:!1}function countCharacters(elem){return(elem.innerText||elem.textContent).length}function loadImage(url){var e=document.createElement("img");return e.width=1,e.height=1,e.style.position="absolute",e.style.top="-10000px",e.style.left="-10000px",e.style.width="1px",e.style.height="1px",e.src=url,e.alt="",document.body.appendChild(e),e}function loadScript(url){var e=document.createElement("script");return e.src=url,document.body.appendChild(e),e}function loadStyle(url){var e=document.createElement("link");return e.type="text/css",e.rel="stylesheet",e.href=url,document.body.appendChild(e),e}function sendError(e){var url=util.buildURL(origin+"/error",{v:version,l:getURL(),n:e.name,m:e.massage,ms_d:e.description,ms_n:e.number,mz_f:e.fileName,mz_l:e.lineNumber,mz_c:e.columnNumber,mz_s:e.stack});errorSent?debug("skip error sending",url):(debug("send error",url),loadImage(url),errorSent=!0),debug(e)}function getURL(){var url=location.toString();return encodeURI(decodeURI(url))}function analyzeContentByBodyElement(){debug("[analyze content mode] fallback");var body=document.body,currentPos=document.documentElement.scrollTop||document.body.scrollTop,start_pos=body.getBoundingClientRect().top+currentPos,height=body.clientHeight,article_chars=countCharacters(body);return{start_pos:start_pos,height:height,article_chars:article_chars}}function analyzeCustomOldContent(currentPos,begin,end){debug("[analyze content mode] custom(old)");var top_rect=begin.getBoundingClientRect(),start_pos=top_rect.top+currentPos,bottom_rect=end.getBoundingClientRect(),bottom_pos=bottom_rect.bottom+currentPos,height=bottom_pos-start_pos,article_chars=countCharacters(begin);return begin!=end&&(article_chars+=countCharacters(end)),{no_content:!1,start_pos:start_pos,height:height,article_chars:article_chars}}function analyzeCustomContent(currentPos){debug("[analyze content mode] custom");for(var start_pos=void 0,bottom_pos=void 0,article_chars=0,i=0;i<params.customContentElements.length;i++){var elem=params.customContentElements[i],lect=elem.getBoundingClientRect(),tmp_start_pos=lect.top+currentPos,tmp_bottom_pos=lect.bottom+currentPos;(util.isUndefined(start_pos)||start_pos>tmp_start_pos)&&(start_pos=tmp_start_pos),(util.isUndefined(bottom_pos)||tmp_bottom_pos>bottom_pos)&&(bottom_pos=tmp_bottom_pos),article_chars+=countCharacters(elem)}var height=bottom_pos-start_pos;return{no_content:!1,start_pos:start_pos,height:height,article_chars:article_chars}}function analyzeContent(){var currentPos=document.documentElement.scrollTop||document.body.scrollTop,isFallbackMode=params.alwaysFallback,content=isCustomMode?analyzeCustomContent(currentPos):isOldCustomMode?analyzeCustomOldContent(currentPos,params.contentBeginElement,params.contentEndElement):isFallbackMode?analyzeContentByBodyElement():analyzer.analyze_content(currentPos);return content.no_content&&(content=analyzeContentByBodyElement()),maxPos=Math.max(maxPos,currentPos),{currentPos:currentPos,maxPos:maxPos,startPos:content.start_pos,contentHeight:content.height,wordCount:content.article_chars}}function now(){return Math.floor((new Date).getTime()/1e3)}function calcScrollReadRate(currentPos,startPos,contentHeight){var height=void 0;return height=window.innerHeight?window.innerHeight:document.documentElement.clientHeight,latestScrollReadRate=Math.floor((height+currentPos-startPos)/contentHeight*100)}function exec(cmd){for(var process=processes[cmd],_len2=arguments.length,args=Array(_len2>1?_len2-1:0),_key2=1;_len2>_key2;_key2++)args[_key2-1]=arguments[_key2];process&&process.apply(void 0,args)}function start(){try{debug("version is "+version);for(var i=0;i<window._lgy_lt.q.length;i++)exec.apply(null,window._lgy_lt.q[i]);window._lgy_lt=function(){try{exec.apply(void 0,arguments)}catch(e){sendError(e)}},prepareOptions()}catch(e){sendError(e)}}function prepareOptions(){if(params.customContentElements&&(util.isArray(params.customContentElements)||(params.customContentElements=[params.customContentElements]),params.customContentElements.length>0)){for(var result=!0,i=0;i<params.customContentElements.length&&(result=result&&checkElement(params.customContentElements[i]),result);i++);isCustomMode=result}isCustomMode||(isOldCustomMode=checkElement(params.contentBeginElement)&&checkElement(params.contentEndElement)),util.isUndefined(params.estimateReadTime)&&(params.estimateReadTime=!0),(isNaN(params.readCharacterNumInMinite)||null==params.readCharacterNumInMinite||params.readCharacterNumInMinite<=0)&&(params.readCharacterNumInMinite=DEFAULT_READ_CHARACTER_NUM_IN_MINUTE)}var cookie=require("./cookie"),uuid=require("./uuid"),util=require("./util"),Analyzer=require("./vendor/article-analyzer"),ltReady=require("./ready"),version="1.1.1",uidKey="_lt",origin=process.env.ORIGIN||"//lt.logly.co.jp",analyzer=new Analyzer,params={},isCustomMode=!1,isOldCustomMode=!1,JUDGE_INACTIVE_TIME=6e4,SEND_LOG_INTERVAL=5e3,ATTENTION_OFFSET_THRESHOLD=SEND_LOG_INTERVAL+5e3,DEFAULT_READ_CHARACTER_NUM_IN_MINUTE=800,QUESTIONARIE_JS_VERSION="2.0.0",QUESTIONARIE_CSS_VERSION="1.0.0",QUESTIONARIE_CHECK_SCROLL_RATE_INTERVAL=500,OPEN_QUESTIONARIE_SCROLL_RATE=70;if(window.isLoyalTrackerScriptAlreadyExecuted)return void debug("Loyal tracker script is already executed.");window.isLoyalTrackerScriptAlreadyExecuted=!0;var errorSent=!1,maxPos=0,latestScrollReadRate=null,pvManager=function(){function init(){sentPV=!1}function sendPV(){if(!sentPV){sentPV=!0;var firstPartyUid=cookie.get(uidKey);if(debug("first party cookie is "+firstPartyUid),!firstPartyUid){firstPartyUid=uuid.logly();var domain=util.getWildcardDomain(document.domain);cookie.set(uidKey,firstPartyUid,1/0,"/",domain)}var url=util.buildURL(origin+"/c",{m:params.media,s:firstPartyUid,l:getURL(),r:document.referrer,u:navigator.userAgent,p:document.title,c:params.category||"",pd:params.publishDate||"",t:new Date/1e3});debug("send pageview",url),loadImage(url)}}var sentPV=void 0;try{init()}catch(e){sendError(e)}return{init:init,sendPV:sendPV}}(),readManager=function(){function init(){loadedAt=now(),reads=[],maxReadRange=1,activeFlg=!1,activeTime=0,activeStart=null,inactiveTimerId=null}function calculateActiveOffset(){var activeOffset=new Date-activeStart;return debug("[calculateActiveOffset] - activeOffset: "+activeOffset),activeOffset>ATTENTION_OFFSET_THRESHOLD&&(activeOffset=0),activeOffset}function setInactiveTimerWithTimeout(delay){inactiveTimerId=window.setTimeout(function(){return setInactiveTimer()},delay)}function setInactiveTimer(){return activeFlg&&(activeFlg=!1,activeTime+=calculateActiveOffset()),setInactiveTimerWithTimeout(JUDGE_INACTIVE_TIME)}function resetInactiveTimer(){try{return activeFlg||(activeFlg=!0,activeStart=new Date),window.clearTimeout(inactiveTimerId),setInactiveTimerWithTimeout(JUDGE_INACTIVE_TIME)}catch(e){sendError(e)}}function resetInactiveTimerImmediately(){try{return window.clearTimeout(inactiveTimerId),setInactiveTimer()}catch(e){sendError(e)}}function resetInactiveTimerImmediatelyIfHide(){try{void 0!==document.visibilityState&&"hidden"==document.visibilityState&&resetInactiveTimerImmediately()}catch(e){sendError(e)}}function resetInactiveTimerForResize(){try{currentWidth==window.innerWidth&&currentHeight==window.innerHeight||(currentWidth=window.innerWidth,currentHeight=window.innerHeight,resetInactiveTimer())}catch(e){sendError(e)}}function attentionTime(){var activeOffset=0;activeFlg&&(activeOffset=calculateActiveOffset()),activeTime+=activeOffset,activeStart=new Date;var time=activeTime/1e3;return Math.round(10*time)/10}function addListener(element,event,func){return element.addEventListener?element.addEventListener(event,func):element.attachEvent?element.attachEvent("on"+event,func):void 0}function start(){addListener(window,"blur",resetInactiveTimerImmediately),addListener(window,"focusout",resetInactiveTimerImmediately),addListener(document,"visibilitychange",resetInactiveTimerImmediatelyIfHide),addListener(window,"resize",resetInactiveTimerForResize),addListener(window,"scroll",resetInactiveTimer),addListener(document,"touchstart",resetInactiveTimer),addListener(document,"touchmove",resetInactiveTimer),addListener(document,"mousemove",resetInactiveTimer),addListener(document,"mousedown",resetInactiveTimer),addListener(document,"keydown",resetInactiveTimer),periodicCheckAndSendData(),addListener(window,"beforeunload",checkAndSendData),addListener(window,"pagehide",checkAndSendData)}function calcReadRange(rate){return Math.min(10,Math.floor(Math.max(rate-1,0)/10+1))}function periodicCheckAndSendData(){window.setTimeout(function(){checkAndSendData(),periodicCheckAndSendData()},SEND_LOG_INTERVAL)}function checkAndSendData(){try{debug("check read range");var firstPartyUid=cookie.get(uidKey);if(!firstPartyUid)return void debug("stop check read range because firstPartyUid is nothing");var _analyzeContent=analyzeContent(),currentPos=_analyzeContent.currentPos,startPos=_analyzeContent.startPos,contentHeight=_analyzeContent.contentHeight,wordCount=_analyzeContent.wordCount;debug("[analyze content result] currentPos:"+currentPos+" startPos:"+startPos+" contentHeight:"+contentHeight+" wordCount:"+wordCount);var scrollReadRate=calcScrollReadRate(currentPos,startPos,contentHeight),readTimeSec=attentionTime(),readRate=void 0,estimatedReadTimeSec=void 0,timeReadRate=void 0;params.estimateReadTime?(estimatedReadTimeSec=Math.floor(wordCount/params.readCharacterNumInMinite*60),timeReadRate=Math.floor(readTimeSec/estimatedReadTimeSec*100),readRate=Math.min(scrollReadRate,timeReadRate)):(estimatedReadTimeSec="―",timeReadRate="―",readRate=scrollReadRate);var readRange=calcReadRange(readRate);if(debug("[read rate] "+("result:"+readRate+" ")+("scroll:"+scrollReadRate+" ")+("time:"+timeReadRate+" (estimated: "+estimatedReadTimeSec+", current:"+readTimeSec+")")),debug("[read range type] "+readRange),debug("[read time sec] "+readTimeSec),readRange>maxReadRange){maxReadRange=readRange;var url=util.buildURL(origin+"/read",{s:firstPartyUid,m:params.media,l:getURL(),r:document.referrer,rrt:readRange,rts:Math.ceil(readTimeSec)});debug("send read",url),loadImage(url)}}catch(e){sendError(e)}}var loadedAt=void 0,reads=void 0,maxReadRange=void 0,activeFlg=void 0,activeTime=void 0,activeStart=void 0,inactiveTimerId=void 0,currentWidth=window.innerWidth,currentHeight=window.innerHeight;try{init()}catch(e){sendError(e)}return{init:init,start:start}}(),questionnaireManager=function(){function init(){checked=!1,que=null}function check(){if(!params.media)return void warn("media is not specified");if(!checked){checked=!0;var url=util.buildURL(origin+"/questionnaire/check.js",{m:params.media,l:getURL(),t:new Date/1e3});debug("send check questionnaire",url),loadScript(url)}}function checkCallback(que){if(debug("questionnaire que [uuid] "+que.uuid+"  [is_enabled] "+que.is_enabled+"  [version] "+que.version+"  [config_json] "+que.config_json),this.que=que,this.que.is_enabled){"v1"==this.que.version&&(this.que.config_json='[{"no":1, "type":1}]'),this.que.config={},this.que.config.questions=JSON.parse(this.que.config_json),this.answer_group_id=uuid.v4(),this.que.config.version=this.que.version,this.que.config.images_path=util.buildURL(origin+"/static/questionnaire/images");var cssUrl=util.buildURL(origin+"/static/questionnaire/app-"+QUESTIONARIE_CSS_VERSION+".css");debug("load questionnaire css",cssUrl),loadStyle(cssUrl),window.setTimeout(function(){var jsUrl=util.buildURL(origin+"/static/questionnaire/app-"+QUESTIONARIE_JS_VERSION+".js");debug("load questionnaire js",jsUrl),loadScript(jsUrl)},500)}else debug("not load questionnaire css/js")}function preparedCallback(openFunc){debug("questionnaire prepared"),this.checkPeriodicAndOpenIfConditionSatisfied(openFunc)}function checkPeriodicAndOpenIfConditionSatisfied(openFunc){debug("check scroll rate to open questionnaire (scroll rate: "+latestScrollReadRate+"%)");var self=this;latestScrollReadRate&&latestScrollReadRate>OPEN_QUESTIONARIE_SCROLL_RATE?(openFunc(self.que.config,function(answer){self.answeredCallback(answer)}),debug("questionnaire opened")):window.setTimeout(function(){self.checkPeriodicAndOpenIfConditionSatisfied(openFunc)},QUESTIONARIE_CHECK_SCROLL_RATE_INTERVAL)}function answeredCallback(answer){debug("questionnaire answered");var firstPartyUid=cookie.get(uidKey);if(!firstPartyUid)return void debug("stop send questionnaire answer because firstPartyUid is nothing");var url=util.buildURL(origin+"/qa",{q:this.que.uuid,v:this.que.version,s:firstPartyUid,qn:answer.no,qt:answer.type,ag:this.answer_group_id,nps:answer.value,t:new Date/1e3});debug("send questionnaire answer",url),loadImage(url)}var checked=null,que=null;try{init()}catch(e){sendError(e)}return{init:init,check:check,checkCallback:checkCallback,preparedCallback:preparedCallback,checkPeriodicAndOpenIfConditionSatisfied:checkPeriodicAndOpenIfConditionSatisfied,answeredCallback:answeredCallback}}(),processes={set:function(key,val){params[key]=val},send:function(target){if("pageview"===target){if(!params.media)return void warn("media is not specified");pvManager.sendPV()}else"read"===target&&readManager.start()},reset:function(target){"read"===target?readManager.init():"pageview"===target&&pvManager.init()},check:function(target){switch(target){case"questionnaire":questionnaireManager.check();break;default:warn("unsupported check target: "+target)}},callback:function(target,func){switch(target){case"questionnaireChecked":questionnaireManager.checkCallback(func);break;case"questionnairePrepared":questionnaireManager.preparedCallback(func);break;default:warn("unsupported callback target: "+target)}}};ltReady(start)}try{main()}catch(e){console&&console.error&&console.error(e)}}).call(this,require("_process"))},{"./cookie":3,"./ready":4,"./util":5,"./uuid":6,"./vendor/article-analyzer":7,_process:1}],3:[function(require,module,exports){"use strict";var set=function(key,value,end,path,domain,secure){if(key&&!/^(?:expires|max\-age|path|domain|secure)$/i.test(key)){var expires="";if(end)switch(end.constructor){case Number:expires=end===1/0?"; expires=Tue, 19 Jan 2038 03:14:07 GMT":"; max-age="+end;break;case String:expires="; expires="+end+end;break;case Date:expires="; expires="+end.toGMTString()}document.cookie=escape(key)+"="+escape(value)+expires+(domain?"; domain="+domain:"")+(path?"; path="+path:"")+(secure?"; secure":"")}},get=function(key){return key&&has(key)?unescape(document.cookie.replace(new RegExp("(?:^|.*;\\s*)"+escape(key).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*((?:[^;](?!;))*[^;]?).*"),"$1")):null},has=function(key){return new RegExp("(?:^|;\\s*)"+escape(key).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(document.cookie)},cookie={};cookie.set=set,cookie.get=get,cookie.has=has,module.exports=cookie},{}],4:[function(require,module,exports){"use strict";var ltReady=void 0;!function(window){var $=function(callback){registerOrRunCallback(callback),bindReady()},document=window.document,readyBound=!1,callbackQueue=[],registerOrRunCallback=function(callback){"function"==typeof callback&&callbackQueue.push(callback)},DOMReadyCallback=function(){for(;callbackQueue.length;)callbackQueue.shift()();registerOrRunCallback=function(callback){callback()}},DOMContentLoaded=function DOMContentLoaded(){document.addEventListener?document.removeEventListener("DOMContentLoaded",DOMContentLoaded,!1):document.detachEvent("onreadystatechange",DOMContentLoaded),DOMReady()},DOMReady=function DOMReady(){if(!$.isReady){if(!document.body)return setTimeout(DOMReady,1);$.isReady=!0,DOMReadyCallback()}},bindReady=function(){var toplevel=!1;if(!readyBound)if(readyBound=!0,"loading"!==document.readyState&&DOMReady(),document.addEventListener)document.addEventListener("DOMContentLoaded",DOMContentLoaded,!1),window.addEventListener("load",DOMContentLoaded,!1);else if(document.attachEvent){document.attachEvent("onreadystatechange",DOMContentLoaded),window.attachEvent("onload",DOMContentLoaded);try{toplevel=null==window.frameElement}catch(e){}document.documentElement.doScroll&&toplevel&&doScrollCheck()}},doScrollCheck=function doScrollCheck(){if(!$.isReady){try{document.documentElement.doScroll("left")}catch(error){return void setTimeout(doScrollCheck,1)}DOMReady()}};$.isReady=!1,ltReady=$}(window),module.exports=ltReady},{}],5:[function(require,module,exports){"use strict";var buildURL=function(base){var qp=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},queries=[];for(var k in qp)if(qp.hasOwnProperty(k)){var q=encodeURIComponent(k)+"="+encodeURIComponent(qp[k]);queries.push(q)}var query=queries.join("&");return query?base+"?"+query:base},getDomain=function(url,subdomain){return subdomain=subdomain||!0,url=url.replace(/(https?:\/\/)?(www.)?/i,""),subdomain||(url=url.split("."),url=url.slice(url.length-2).join(".")),-1!==url.indexOf("/")?url.split("/")[0]:url},getWildcardDomain=function(url){var domain=getDomain(url);return/\./.test(domain)?"."+domain:domain},isArray=function(it){return"[object Array]"===Object.prototype.toString.call(it)},isUndefined=function(val){return"undefined"==typeof val},util={};util.buildURL=buildURL,util.getDomain=getDomain,util.getWildcardDomain=getWildcardDomain,util.isArray=isArray,util.isUndefined=isUndefined,module.exports=util},{}],6:[function(require,module,exports){"use strict";var generateLegacyBytes=function(len){for(var arr=[],i=0;16>i;i++)arr[i]=Math.floor(256*Math.random());return arr},generateBytes=function(){var len=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16;try{if("undefined"==typeof window||!window.crypto)return generateLegacyBytes(len);var arr=new Uint8Array(len);window.crypto.getRandomValues(arr);for(var bytes=[],i=0;len>i;i++)bytes[i]=arr[i];return bytes}catch(e){return generateLegacyBytes(len)}},toHex=function(arr){for(var res=[],j=0;j<arr.length;j++){var i=arr[j],s=i.toString(16);res.push(1===s.length?"0"+s:s)}return res.join("")},v4=function(){var rnd=generateBytes();rnd[6]=15&rnd[6]|64,rnd[8]=63&rnd[8]|128;var arr=toHex(rnd).match(/(.{8})(.{4})(.{4})(.{4})(.{12})/);return arr.shift(),arr.join("-")},isValid=function(uuid){var pattern=/^[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/;return pattern.test(uuid)},logly=function(){return v4().split("-").join("").slice(0,27)},uuid={};uuid.v4=v4,uuid.isValid=isValid,uuid.logly=logly,module.exports=uuid},{}],7:[function(require,module,exports){"use strict";var ExtractContentJS=require("./extract-content"),LoglyArticleAnalyzer=function(){this.constructor=function(){},this.extractor=function(){return this.ex?this.ex:(this.ex=new ExtractContentJS.LayeredExtractor,this.ex.addHandler(this.ex.factory.getHandler("Heuristics")))},this.element_by=function(node){var span=document.createElement("span");return node.parentNode.insertBefore(span,node),span.appendChild(node),span},this.top_element=function(top_node){return this.top_node===top_node?this.top_node_parent:(this.top_node=top_node,this.top_node_parent=this.top_node.parentNode,this.top_node_parent)},this.bottom_element=function(bottom_node){return this.bottom_node===bottom_node?this.bottom_node_parent:(this.bottom_node=bottom_node,this.bottom_node_parent=this.bottom_node.parentNode,this.bottom_node_parent)},this.analyze_content=function(current_scroll_pos){var res=this.extractor().extract(document);if(res.isSuccess){var leaves=res.content.asLeaves(),top_rect=this.top_element(leaves[0].node).getBoundingClientRect(),start_pos=top_rect.top+current_scroll_pos,bottom_rect=this.bottom_element(leaves[leaves.length-1].node).getBoundingClientRect(),bottom_pos=bottom_rect.bottom+current_scroll_pos,height=bottom_pos-start_pos,chars=res.content.asTextFragment().length;return{no_content:!1,start_pos:start_pos,height:height,article_chars:chars}}return{no_content:!0}}};module.exports=LoglyArticleAnalyzer},{"./extract-content":8}],8:[function(require,module,exports){"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},ExtractContentJS={Lib:{}};ExtractContentJS.Lib.Util=function(){var Util={};return Util.BenchmarkTimer=function(){var now=function(){var d=new Date,t=0;return t=d.getHours(),t=60*t+d.getMinutes(),t=60*t+d.getSeconds(),t=1e3*t+d.getMilliseconds()},Timer=function(){var self={elapsed:0};return self.reset=function(){return self.elapsed=0,self},self.start=function(){return self.msec=now(),self},self.stop=function(){return self.elapsed+=now()-self.msec,self},self.start()},self={timers:{}};return self.get=function(name){return self.timers[name]||(self.timers[name]=new Timer),self.timers[name]},self.reset=function(name){return self.get(name).reset()},self.start=function(name){return self.get(name).start()},self.stop=function(name){return self.get(name).stop()},self},Util.Token=function(word){var regex={hiragana:/[\u3042-\u3093\u304C-\u307C\u3041-\u3087\u308E\u3063\u30FC]/,katakana:/[\u30A2-\u30F3\u30AC-\u30DC\u30A1-\u30E7\u30EE\u30C3\u30FC]/,kanji:{test:function(w){return w>="一"&&"龠">=w||"々"===w}},alphabet:/[a-zA-Z]/,digit:/[0-9]/},tests=function(w){var match={};for(var r in regex)regex[r].test(w)&&(match[r]=regex[r]);return match},self={first:tests(word.charAt(0)),last:tests(word.charAt(word.length-1))};return self.isTokenized=function(prev,next){var p=prev.length?prev.charAt(prev.length-1):"",n=next.length?next.charAt(0):"",check=function(w,test){if(w.length)for(var t in test)if(test[t].test(w))return!1;return!0};return check(p,self.first)&&check(n,self.last)},self},Util.inherit=function(child,parent){var obj=child||{};for(var prop in parent)"undefined"==typeof obj[prop]&&(obj[prop]=parent[prop]);return obj},Util.countMatch=function(text,regex){return text.split(regex).length-1},Util.countMatchTokenized=function(text,word){for(var count=0,prev=null,tok=new Util.Token(word),texts=text.split(word),len=texts.length,i=0;len>i;i++)prev&&tok.isTokenized(prev,texts[i])&&count++,prev=texts[i];return count},Util.indexOfTokenized=function(text,word){var index=text.indexOf(word);if(index>=0){var tok=new Util.Token(word),p=index>1?text.substr(index-1,1):"",n=text.substr(index+word.length,1);if(tok.isTokenized(p,n))return index}return-1},Util.dump=function(obj){if("undefined"==typeof obj)return"undefined";if("string"==typeof obj)return'"'+obj+'"';if("object"!=("undefined"==typeof obj?"undefined":_typeof(obj)))return""+obj;if(null===obj)return"null";if(obj instanceof Array)return"["+obj.map(function(v){return"obj"}).join(",")+"]";var arr=[];for(var prop in obj)arr.push(prop+":obj");return"{"+arr.join(",")+"}"},Util}(),ExtractContentJS.Lib.A=function(){var A={};return A.indexOf=Array.indexOf||function(self,elt){var argi=2,len=self.length,from=Number(arguments[argi++])||0;for(from=0>from?Math.ceil(from):Math.floor(from),0>from&&(from+=len);len>from;from++)if(from in self&&self[from]===elt)return from;return-1},A.filter=Array.filter||function(self,fun){var argi=2,len=self.length;if("function"!=typeof fun)throw new TypeError("A.filter: not a function");for(var rv=new Array,thisp=arguments[argi++],i=0;len>i;i++)if(i in self){var val=self[i];fun.call(thisp,val,i,self)&&rv.push(val)}return rv},A.forEach=Array.forEach||function(self,fun){var argi=2,len=self.length;if("function"!=typeof fun)throw new TypeError("A.forEach: not a function");for(var thisp=arguments[argi++],i=0;len>i;i++)i in self&&fun.call(thisp,self[i],i,self)},A.every=Array.every||function(self,fun){var argi=2,len=self.length;if("function"!=typeof fun)throw new TypeError("A.every: not a function");for(var thisp=arguments[argi++],i=0;len>i;i++)if(i in self&&!fun.call(thisp,self[i],i,self))return!1;return!0},A.map=Array.map||function(self,fun){var argi=2,len=self.length;if("function"!=typeof fun)throw new TypeError("A.map: not a function");for(var rv=new Array(len),thisp=arguments[argi++],i=0;len>i;i++)i in self&&(rv[i]=fun.call(thisp,self[i],i,self));return rv},A.some=Array.some||function(self,fun){var argi=2,len=self.length;if("function"!=typeof fun)throw new TypeError("A.some: not a function");for(var thisp=arguments[argi++],i=0;len>i;i++)if(i in self&&fun.call(thisp,self[i],i,self))return!0;return!1},A.reduce=Array.reduce||function(self,fun){var argi=2,len=self.length;if("function"!=typeof fun)throw TypeError("A.reduce: not a function ");var i=0;if(arguments.length>argi)var rv=arguments[argi++];else for(;;){if(i in self){rv=self[i++];break}if(++i>=len)throw new TypeError("A.reduce: empty array")}for(;len>i;i++)i in self&&(rv=fun.call(null,rv,self[i],i,self));return rv},A.zip=function(self){if(self[0]instanceof Array){for(var l=self[0].length,len=self.length,z=new Array(l),i=0;l>i;i++){z[i]=[];for(var j=0;len>j;j++)z[i].push(self[j][i])}return z}return[]},A.first=function(self){return self?self[0]:null},A.last=function(self){return self?self[self.length-1]:null},A.push=function(self,other){return Array.prototype.push.apply(self,other)},A}(),ExtractContentJS.Lib.DOM=function(){var A=ExtractContentJS.Lib.A,DOM={};return DOM.getElementStyle=function(elem,prop){var style=elem.style?elem.style[prop]:null;if(!style){var dv=elem.ownerDocument.defaultView;if(dv&&dv.getComputedStyle){try{var styles=dv.getComputedStyle(elem,null)}catch(e){return null}prop=prop.replace(/([A-Z])/g,"-$1").toLowerCase(),style=styles?styles.getPropertyValue(prop):null}else elem.currentStyle&&(style=elem.currentStyle[prop])}return style},DOM.text=function(node){return"undefined"!=typeof node.textContent?node.textContent:"#text"==node.nodeName?node.nodeValue:"undefined"!=typeof node.innerText?node.innerText:null},DOM.ancestors=function(e){for(var body=e.ownerDocument.body,r=[],it=e;it!=body;)r.push(it),it=it.parentNode;return r.push(body),r},DOM.commonAncestor=function(e1,e2){for(var a1=DOM.ancestors(e1).reverse(),a2=DOM.ancestors(e2).reverse(),r=null,i=0;a1[i]&&a2[i]&&a1[i]==a2[i];i++)r=a1[i];return r},DOM.countMatchTagAttr=function(node,tag,attr,regexs){var test=function(v){return v.test(node[attr])};if((node.tagName||"").toLowerCase()==tag&&A.some(regexs,test))return 1;for(var n=0,children=node.childNodes,i=0,len=children.length;len>i;i++)n+=DOM.countMatchTagAttr(children[i],tag,attr,regexs);return n},DOM.matchTag=function(node,pat){return A.some(pat,function(v){return"string"==typeof v?v==(node.tagName||"").toLowerCase():v instanceof Array?v[0]==(node.tagName||"").toLowerCase()&&DOM.matchAttr(node,v[1]):!1})},DOM.matchAttr=function(node,pat){var test=function test(pat,val){if("string"==typeof pat)return pat==val;if(pat instanceof RegExp)return pat.test(val);if(pat instanceof Array)return A.some(pat,function(v){return test(v,val)});if(pat instanceof Object)for(var prop in pat){var n=node[prop];if(n&&DOM.matchAttr(n,pat[prop]))return!0}return!1};for(var prop in pat){var attr=node[prop],ar=pat[prop];if(attr)return test(ar,attr)}return!1},DOM.matchStyle=function(node,pat){var test=function test(pat,val){return"string"==typeof pat?pat==val:pat instanceof RegExp?pat.test(val):pat instanceof Array?A.some(pat,function(v){return test(v,val)}):!1};for(var prop in pat)if(test(pat[prop],DOM.getElementStyle(node,prop)))return!0;return!1},DOM}(),function(ns){var Util=ns.Lib.Util,A=ns.Lib.A,DOM=ns.Lib.DOM,Leaf=Util.inherit(function(node){var depth=arguments[1]||0,inside=arguments[2]||{},limit=arguments[3]||1048576,leaf={node:node,depth:depth,inside:inside};return leaf.statistics=function(){var t=(DOM.text(node)||"").replace(/\s+/g," "),l=t.length;return{text:t.substr(0,limit),noLinkText:inside.link||inside.form?"":t,listTextLength:inside.list?l:0,noListTextLength:inside.list?0:l,linkCount:inside.link?1:0,listCount:inside.li?1:0,linkListCount:inside.li&&inside.link?1:0}},leaf},{commonAncestor:function(){var ar=A.map(arguments,function(v){return v.node});return ar.length<2?ar[0]:A.reduce(ar,function(prev,curr){return DOM.commonAncestor(prev,curr)})},mergeStatistics:function(a,b){var r={};for(var prop in a)r[prop]=a[prop]+b[prop];return r}}),Block=function(leaves){leaves=A.filter(leaves,function(v){var s=DOM.text(v.node)||"";return s=s.replace(/\s+/g,""),0!=s.length});var block={score:0,leaves:leaves};return block.commonAncestor=function(){return Leaf.commonAncestor.apply(null,block.leaves)},block},Content=function(c){var self={_content:c};return self.asLeaves=function(){return self._content},self.asNode=function(){return self._node?self._node:(self._node=Leaf.commonAncestor.apply(null,self._content),self._node)},self.asTextFragment=function(){
return self._textFragment?self._textFragment:self._content.length<1?"":(self._textFragment=A.reduce(self._content,function(prev,curr){var s=DOM.text(curr.node);return s=s.replace(/^\s+/g,"").replace(/\s+$/g,""),s=s.replace(/\s+/g," "),prev+s},""),self._textFragment)},self.asText=function(){if(self._text)return self._text;var node=self.asNode();return self._text=node?DOM.text(node):"",self._text},self.toString=function(){return self.asTextFragment()},self};ns.LayeredExtractor=function(){var self={handler:arguments[0]||[],filter:arguments[1]||{}};return self.factory={getHandler:function(name){return"undefined"!=typeof ns.LayeredExtractor.Handler?new ns.LayeredExtractor.Handler[name]:null}},self.addHandler=function(handler){return"undefined"!=typeof handler&&self.handler.push(handler),self},self.filterFor=function(url){},self.extract=function(d){for(var url=d.location.href,res={title:d.title,url:d.location.href},len=self.handler.length,i=0;len>i;i++){var content=self.handler[i].extract(d,url,res);if(content){var f=self.filterFor(url);if(f&&(content=f.filter(content)),content=new Content(content),content.toString().length){res.content=content,res.isSuccess=!0,res.engine=res.engine||self.handler[i];break}}}return res},self},ns.LayeredExtractor.Handler={},ns.LayeredExtractor.Handler.Heuristics=function(){var self={name:"Heuristics",content:[],opt:Util.inherit(arguments[0],{threshold:60,minLength:30,factor:{decay:.75,noBody:.72,continuous:1.16},punctuationWeight:10,minNoLink:8,noListRatio:.2,limit:{leaves:800,recursion:20,text:1048576},debug:!1}),pat:Util.inherit(arguments[1],{sep:["div","center","td","h1","h2"],waste:[/Copyright|All\s*Rights?\s*Reserved?/i],affiliate:[/amazon[a-z0-9\.\/\-\?&]+-22/i],list:["ul","dl","ol"],li:["li","dd"],a:["a"],form:["form"],noContent:["frameset"],ignore:["iframe","img","script","style","select","noscript",["div",{id:[/more/,/menu/,/side/,/navi/],className:[/more/,/menu/,/side/,/navi/]}]],ignoreStyle:{display:"none",visibility:"hidden"},punctuations:/[\u3002\u3001\uFF0E\uFF0C\uFF01\uFF1F]|\.[^A-Za-z0-9]|,[^0-9]|!|\?/})},MyBlock=Util.inherit(function(leaves){var block=new Block(leaves);return block.eliminateLinks=function(){var st=A.map(block.leaves,function(v){return v.statistics()});if(!st.length)return"";st=1==st.length?st[0]:A.reduce(st,function(prev,curr){return Leaf.mergeStatistics(prev,curr)});var nolinklen=st.noLinkText.length,links=st.linkCount,listlen=st.listTextLength;if(nolinklen<self.opt.minNoLink*links)return"";var rate=st.linkListCount/(st.listCount||1);rate*=rate;var limit=self.opt.noListRatio*rate*listlen;return limit>nolinklen?"":st.noLinkText},block.noBodyRate=function(){var val=0;return block.leaves.length>0&&(val+=A.reduce(block.leaves,function(prev,curr){return prev+DOM.countMatchTagAttr(curr.node,"a","href",self.pat.affiliate)},0)),val/=2,val+=A.reduce(self.pat.waste,function(prev,curr){return prev+Util.countMatch(block._nolink,curr)},0)},block.calcScore=function(factor,continuous){if(block._nolink=block.eliminateLinks(),block._nolink.length<self.opt.minLength)return 0;var c=Util.countMatch(block._nolink,self.pat.punctuations);c*=self.opt.punctuationWeight,c+=block._nolink.length,c*=factor;var noBodyRate=block.noBodyRate();return c*=Math.pow(self.opt.factor.noBody,noBodyRate),block._c=block.score=c,block._c1=c*continuous,c},block.isAccepted=function(){return block._c>self.opt.threshold},block.isContinuous=function(){return block._c1>self.opt.threshold},block.merge=function(other){return block.score+=other._c1,block.depth=Math.min(block.depth,other.depth),A.push(block.leaves,other.leaves),block},block},{split:function(node){var r=[],buf=[],leaves=0,limit=self.opt.limit.text,flush=function(flag){flag&&buf.length&&(r.push(new MyBlock(buf)),buf=[])},rec=function rec(node,depth,inside){if(leaves>=self.opt.limit.leaves)return r;if(depth>=self.opt.limit.recursion)return r;if("#comment"==node.nodeName)return r;if(DOM.matchTag(node,self.pat.ignore))return r;if(DOM.matchStyle(node,self.pat.ignoreStyle))return r;for(var children=node.childNodes,sep=self.pat.sep,len=children.length,flags={form:inside.form||DOM.matchTag(node,self.pat.form),link:inside.link||DOM.matchTag(node,self.pat.a),list:inside.list||DOM.matchTag(node,self.pat.list),li:inside.li||DOM.matchTag(node,self.pat.li)},i=0;len>i;i++){var c=children[i],f=DOM.matchTag(c,sep);flush(f),rec(c,depth+1,flags),flush(f)}return len||(leaves++,buf.push(new Leaf(node,depth,flags,limit))),r};return rec(node,0,{}),flush(!0),r}});return self.extract=function(d){var isNoContent=function(v){return 0!=d.getElementsByTagName(v).length};if(A.some(self.pat.noContent,isNoContent))return self;for(var last,factor=1,continuous=1,res=[],blocks=MyBlock.split(d.body),len=blocks.length,i=0;len>i;i++){var block=blocks[i];last&&(continuous/=self.opt.factor.continuous),block.calcScore(factor,continuous)&&(factor*=self.opt.factor.decay,block.isAccepted()?(block.isContinuous()&&last?last.merge(block):(last=block,res.push(block)),continuous=self.opt.factor.continuous):last||(factor=1))}self.blocks=res.sort(function(a,b){return b.score-a.score});var best=A.first(self.blocks);return best&&(self.content=best.leaves),self.content},self},ns.LayeredExtractor.Handler.GoogleAdSection=function(){var self={name:"GoogleAdSection",content:[],state:[],opt:Util.inherit(arguments[0],{limit:{leaves:800,recursion:20},debug:!1})},pat={ignore:/google_ad_section_start\(weight=ignore\)/i,section:/google_ad_section_start/i,end:/google_ad_section_end/i},stIgnore=1,stSection=2;return self.inSection=function(){return A.last(self.state)==stSection},self.ignore=function(){self.state.push(stIgnore)},self.section=function(){self.state.push(stSection)},self.end=function(){self.state.length&&self.state.pop()},self.parse=function(node){var depth=arguments[1]||0;if("#comment"==node.nodeName)return void(pat.ignore.test(node.nodeValue)?self.ignore():pat.section.test(node.nodeValue)?self.section():pat.end.test(node.nodeValue)&&self.end());if(!(self.content.length>=self.opt.limit.leaves||depth>=self.opt.limit.recursion)){for(var children=node.childNodes,len=children.length,i=0;len>i;i++){var c=children[i];self.parse(c,depth+1)}!len&&self.inSection()&&self.content.push(new Leaf(node,depth))}},self.extract=function(d){return self.parse(d),self.blocks=[new Block(self.content)],self.content},self}}(ExtractContentJS),module.exports=ExtractContentJS},{}]},{},[2]);
