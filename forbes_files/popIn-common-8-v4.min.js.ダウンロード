!function(){"use strict";(window.PopIn||{}).define("Common",{})}(),function(e,i){"use strict";function t(e){return"object"==typeof e&&"function"==typeof e.getItem&&"function"==typeof e.setItem&&"function"==typeof e.removeItem}function n(){return null}var r,o,s={STORAGE_NAME_MAP:{local:"localStorage",session:"sessionStorage"}},a={get:function(e,t){return i[this.STORAGE_NAME_MAP[e]].getItem(t)},set:function(e,t,n){return i[this.STORAGE_NAME_MAP[e]].setItem(t,n)},remove:function(e,t){return i[this.STORAGE_NAME_MAP[e]].removeItem(t)}};try{r=t(i.sessionStorage)&&t(i.localStorage)}catch(e){r=!1}for(o in a)s[o]=!0===r?a[o]:n;e.define("Common.Storage",s)}(window.PopIn,window),function(e){"use strict";function s(){for(var e={},t=0;t<arguments.length;t++){var n,i=arguments[t];for(n in i)e[n]=i[n]}return e}function c(e){return e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)}e.define("Common.Cookie",function e(a){function n(e,t,n){if("undefined"!=typeof document){"number"==typeof(n=s(o.defaults,n)).expires&&(n.expires=new Date(Date.now()+864e5*n.expires)),n.expires&&(n.expires=n.expires.toUTCString()),t=a.write?a.write(t,e):encodeURIComponent(String(t)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),e=encodeURIComponent(String(e)).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var i,r="";for(i in n)n[i]&&(r+="; "+i,!0!==n[i]&&(r+="="+n[i].split(";")[0]));return document.cookie=e+"="+t+r}}var o={defaults:{path:"/"},set:n,get:function(e){if("undefined"!=typeof document&&(!arguments.length||e)){for(var t=document.cookie?document.cookie.split("; "):[],n={},i=0;i<t.length;i++){var r=t[i].split("="),o=r.slice(1).join("=");'"'===o.charAt(0)&&(o=o.slice(1,-1));try{var s=c(r[0]);if(n[s]=(a.read||a)(o,s)||c(o),e===s)break}catch(e){}}return e?n[e]:n}},remove:function(e,t){n(e,"",s(t,{expires:-1}))},withConverter:e};return o}(function(){}))}(window.PopIn,window),function(i){"use strict";var t="_ss_pp_id",r="_ss_pp_id",n=/^[\d\w]{32}|\d{13}$/,o="OPT_OUT",s="uid_gen_time",a=!1,c="";function e(){var e=new Date;return e.setMinutes(e.getMinutes()+e.getTimezoneOffset()),""+e.getTime()}function d(e){var t=parseInt(Math.floor(Math.random()*Math.pow(16,e))).toString(16);return(""+Math.pow(10,e)+t).slice(-e)}function u(e){return(n.test(e)||o===e)&&e}function h(e){i.Common.Storage.set("local",t,e),function(){var e,t=location.host.split("."),n=t.length-2;do{if(e="."+t.slice(n).join("."),i.Common.Cookie.set(r,c,{expires:365,domain:e,path:"/"}),i.Common.Cookie.get(r))break}while(0<=--n)}()}h(c=u(i.Common.Cookie.get(r))||u(i.Common.Storage.get("local",t))||(a=!0,i.Common.Storage.set("local",s,e()),[d(8),d(4),d(4),d(3),e()].join(""))),i.define("Common.Uid",{getUid:function(){return c},setUid:function(e,t){var n;u(e)&&(e===c||a||(n=i.Common.Utils.getUserInfo(),function e(t){window.Treasure2?new window.Treasure2({writeKey:"8378/25839e06ce4cc1cab55c1c1f1e49d336d6d1d48f",database:"popin_user_id"}).addRecord("popin_uid_change_log",t):setTimeout(function(){e(t)},1e3)}({previous_id:c,current_id:e,host:location.host,media:t||"",os:n.os,device:i.DEVICE||"",os_version:n.os_version,browser:n.browser,browser_version:n.browser_version,screen:n.screen,viewport:n.viewport,charset:n.charset,language:n.language,color:n.color})),h(c=e),a=!1)},getUidCTime:function(){return c&&13<c.length?c.substring(c.length-13,c.length):""},getUidGenTime:function(){var e="",t=this.getUidCTime(),n=i.Common.Storage.get("local",s);return new RegExp("^[0-9]*$").test(t)?e=t:n&&(e=n),e}})}(window.PopIn,window),function(e,s){"use strict";e.createClass("Common.NodeBuilder",function(e){this.structures=e},{build:function(){return!1===Array.isArray(this.structures)&&(this.structures=[this.structures]),this.createNodes(this.structures)},createNodes:function(e){for(var t,n,i=s.createDocumentFragment(),r=0,o=e.length;r<o;r++)"object"==typeof(n=e[r])&&(t=this.createNode(n),n=n.children,!0===Array.isArray(n)&&0<n.length&&(n=this.createNodes(n),t.appendChild(n)),i.appendChild(t));return this._getTopNode(i)},createNode:function(e){var t=s.createElement(e.tagName);return this._setProperty(t,e.property),this._setClass(t,e.classList),t},_getTopNode:function(e){return 1<e.childElementCount||e.children&&1<e.children.length||1<e.childNodes.length?e:e.firstElementChild||e.firstChild},_setProperty:function(e,t){var n,i;if("object"==typeof t)for(i in t)"object"==typeof(n=t[i])?this._setProperty(e[i],n):e[i]=n},_setClass:function(e,t){if(t){var n=e.classList;if(!0===Array.isArray(t))for(var i=0,r=t.length;i<r;i++)n.add(t[i]);else n.add(t)}}})}(window.PopIn,document),function(r,s,a,c){"use strict";var o=r.Common.NodeBuilder,d="__popIn_dom_key__",u=[];r.define("Common.Utils",{replaceAll:function(e,t){if(!e||!t)return e;for(var n,i=e,r=0,o=t.length;r<o;r++)for(var s in n=t[r])i=i.replace(new RegExp(s),n[s]);return i},getClientHW:function(){return null!=window.innerWidth?{width:window.innerWidth,height:window.innerHeight}:"CSS1Compat"===document.compatMode?{width:document.documentElement.clientWidth,height:document.documentElement.clientHeight}:{width:document.body.clientWidth,height:document.body.clientHeight}},convertQueryStringToObject:function(e){for(var t,n=e.replace(/^\?/,"").split("&"),i={},r=0,o=n.length;r<o;r++)i[(t=n[r].split("="))[0]]=t[1];return i},getRootDomain:function(e){for(var t=e.split("."),n=[],i=t.pop();0<t.length&&"www"!==i&&(n.push(i),!(3<i.length&&0<n.length));i=t.pop());return n.reverse().join(".")},setValueToObjectIfConditionIsMet:function(e,t,n,i){!0===e&&(i[n]=t)},createIframeBodyOuterHTML:function(e){var t=[];return t.push('<body style="margin:0px;padding:0px;background-color: transparent;">',"<script>window.inDapIF = true;<\/script>",e,"</body>"),t.join("")},writeCodeInIframe:function(e){var t=this.createIFrameObject("javascript:false");a.body.appendChild(t.element),t.write(this.createIframeBodyOuterHTML(e))},createIFrameObject:function(e,t){return{element:new o({tagName:"iframe",property:{src:e=e||"about:self",scrolling:"no",frameBorder:0,style:{display:(t=t||{}).display||"block",width:t.width||0,height:t.height||0,margin:t.margin||0,padding:t.padding||0,overflow:t.overflow||"none"}}}).build(),write:function(e){var t=this.element;null===t.contentDocument?setTimeout(this.write.bind(this,e),r.RETRY_INTERVAL):this._writeTextInIframe(t,e)},_writeTextInIframe:function(e,t){e=e.contentDocument;e.open(),e.write(t),e.close()}}},DIGEST_CHARS:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!$",digest:function(e){for(var t=0,n="",i=0,r=e.length;i<r;i++)t=(t<<5)-t+e.charCodeAt(i),t|=0;for(var o=0;o<6;o++)n+=this.DIGEST_CHARS.charAt(63&t),t>>>=6;return n},shuffle:function(e,t){for(var n,i,r=e.length;0!==r;)i=Math.floor(Math.random()*r),n=e[--r],e[r]=e[i],e[i]=n;return e},requestByJSONP:function(e,t){void 0===this.requestByJSONP._count&&(this.requestByJSONP._count=0);var n=r.JSONP_REQUEST_CALLBACK+this.requestByJSONP._count;if(void 0!==s[n])return this.requestByJSONP._count++,void this.requestByJSONP.call(this,e,t);s[n]=function(e){"function"==typeof t&&t(e),delete s[n]};var i=new o({tagName:"script",property:{src:e+"&callback="+n,type:"text/javascript",charSet:"UTF-8",async:!0}}),e=a.getElementsByTagName("script")[0];e.parentNode.insertBefore(i.build(),e),this.requestByJSONP._count++},getOS:function(e){switch(!0){case/Android/.test(e):return"Android";case/iPhone|iPad|iPod/.test(e):return"iOS";case/Windows/.test(e):return"Windows";case/Mac OS X/.test(e):return"Mac"}return"other"},_normalizeSemverString:function(e){e=e.split(/[._]/);return(parseInt(e[0],10)||0)+"."+(parseInt(e[1],10)||0)+"."+(parseInt(e[2],10)||0)},_getVersion:function(e,t){try{return this._normalizeSemverString(e.split(t)[1].trim().split(/[^\w.]/)[0])}catch(e){}return"0.0.0"},getOSVersion:function(e,t){switch(t){case"Android":return this._getVersion(e,"Android");case"iOS":return this._getVersion(e,/OS /);case"Windows":return this._getVersion(e,/Phone/.test(e)?/Windows Phone (?:OS )?/:/Windows NT/);case"Mac":return this._getVersion(e,/Mac OS X /)}return"0.0.0"},getBrowser:function(e){switch(!0){case/CriOS/.test(e):return"Chrome for iOS";case/Edge/.test(e):return"Edge";case/Chrome/.test(e):return"Chrome";case/Firefox/.test(e):return"Firefox";case/Android/.test(e):return"AOSP";case/MSIE|Trident/.test(e):return"IE";case/Safari\//.test(e):return"Safari";case/AppleWebKit/.test(e):return"WebKit";case/Vivaldi/.test(e):return"Vivaldi"}return""},getBrowserVersion:function(e,t){switch(t){case"Chrome for iOS":return this._getVersion(e,"CriOS/");case"Edge":return this._getVersion(e,"Edge/");case"Chrome":return this._getVersion(e,"Chrome/");case"Firefox":return this._getVersion(e,"Firefox/");case"Vivaldi":return this._getVersion(e,"Vivaldi/");case"AOSP":return this._getVersion(e,/Silk/.test(e)?"Silk/":"Version/");case"IE":return/IEMobile/.test(e)?this._getVersion(e,"IEMobile/"):/MSIE/.test(e)?this._getVersion(e,"MSIE "):this._getVersion(e,"rv:");case"Safari":return this._getVersion(e,"Version/");case"Webkit":return this._getVersion(e,"WebKit/")}return""},getScreen:function(){var e=s.screen;try{e=s.parent.screen}catch(e){}return e?[e.width,e.height].join("x"):"-"},getViewPort:function(){var e=a.documentElement,t=e&&e.clientHeight,n=e&&e.clientWidth,i=s.innerHeight,e=s.innerWidth;return(n<e?e:n)+"x"+(t<i?i:t)},getUserInfo:function(){if(this.getUserInfo._chached)return this.getUserInfo._chached;var e=s.navigator,t=e.userAgent,n=this.getOS(t),i=this.getOSVersion(t,n),r=this.getBrowser(t),o=this.getBrowserVersion(t,r);return this.getUserInfo._chached={os:n,os_version:i,browser:r,browser_version:o,screen:this.getScreen(),viewport:this.getViewPort(),user_agent:t,referrer:a.referrer,path:c.pathname,charset:(a.characterSet||a.charset||"-").toLowerCase(),language:e&&(e.language||e.language||e.browserLanguage||"-").toLowerCase(),color:s.screen?s.screen.colorDepth+"-bit":"-",title:a.title,url:c.href.split("#")[0],platform:e.platform,host:c.host}},parseUrl:function(e){var t,r={};return 0<e.indexOf("?")&&(t=e.substring(e.indexOf("?")),e=e.substring(0,e.indexOf("?")),t.replace(new RegExp("([^?=&]+)(=([^&]*))?","g"),function(e,t,n,i){r[t]=i})),{url:e,qString:r}},parseUri:function(e){e=e.match(/^(?:([^:/?#]+):)?(?:\/\/([^/?#]*))?([^?#]*)(?:\?([^#]*))?(?:#(.*))?/);return null===e?null:{scheme:e[1],host:e[2],path:e[3],query:e[4],fragment:e[5]}},convertObjectToParameterString:function(e){var t,n,i="";for(n in e)void 0!==(t=e[n])&&(i+=(""===i?"":"&")+n+"="+t);return i},killEvent:function(e){e.preventDefault(),e.stopPropagation()},renderNode:function(e,t,n){switch(n.toLowerCase()){case"beforebegin":t.parentNode.insertBefore(e,t);break;case"afterbegin":t.insertBefore(e,t.firstChild);break;case"beforeend":t.appendChild(e);break;case"afterend":t.parentNode.insertBefore(e,t.nextSibling)}},getSupportedDevice:function(){return void 0!==this.getSupportedDevice._device?this.getSupportedDevice._device:this.getSupportedDevice._device="mobile"===this.getDevice(navigator.userAgent)?"mobile":"pc"},generateBasicLogValue:function(e){var t,n,i="";for(n in e=e||{})void 0!==(t=e[n])&&(i+=(""===i?"":"|")+encodeURIComponent(n+t));return i},generateR5Value:function(e){var t,n={};for(t in e=e||{})n[t+"_"]=e[t];return this.generateBasicLogValue(n)},includes:function(e,t){for(var n=0,i=t.length;n<i;n++)if(t[n]===e)return!0;return!1},requestByImageBeacon:function(e,t,n){var i=new Image;"function"==typeof t&&i.addEventListener("load",t,!1),"function"==typeof n&&i.addEventListener("error",n,!1),i.src=e},getPosition:function(e){var t=e.getBoundingClientRect(),n=s.pageXOffset,e=s.pageYOffset;return{top:e+t.top,left:n+t.left,right:n+t.right,bottom:e+t.bottom}},getSize:function(e){return{width:e.offsetWidth,height:e.offsetHeight}},calculateNodeArea:function(e){return e.offsetWidth*e.offsetHeight},getPopInDomData:function(e,t){if(!e)return{};e=+e[d];if("number"!=typeof e||NaN===e)return null;e=u[e]||null;return"string"==typeof t?e[t]:e},setPopInDomData:function(e,t,n){if(!e)return null;var i=e[d]||"",r={};return""===i?(i=u.length,e[d]=i):r=u[i=+i]||{},"string"==typeof t?r[t]=n:"[object Object]"===Object.prototype.toString.call(t)&&(r=Object.assign(r,t)),u[i]=r},getGMTTimeStamp(){var e=new Date;return e.setMinutes(e.getMinutes()+e.getTimezoneOffset()),""+e.getTime()}})}(window.PopIn,window,document,window.location),function(e,t){"use strict";var n=e.Common,i=n.Utils,r=n.NodeBuilder;e.define("Common.CSSManager",{css:"",_cache:[],_node:void 0,add:function(e){"object"==typeof e&&(e=this.convertObjectToCSS(e));var t=i.digest(e),n=this._cache;!1===i.includes(t,n)&&(this.css+=e,n.push(t))},convertObjectToCSS:function(e){return JSON.stringify(e,null,"\n").replace(/,[\n\r]/g,";").replace(/[\n\r]|^{|}$|"/g,"").replace(/:\s?{/g,"{").replace(/};?/g,";}")},render:function(){void 0===this._node?this._node=this._createNode(this.css):this._node.textContent+=this.css,this.css=""},_createNode:function(e){e=new r({tagName:"style",property:{type:"text/css",rel:"stylesheet",charSet:"UTF-8",textContent:e}}).build();return t.getElementsByTagName("head")[0].appendChild(e),e}})}(window.PopIn,document),function(){"use strict";(window.PopIn||{}).createClass("Common.Publisher",function(){this._subscribers={}},{on:function(e,t){var n=this._subscribers;return!1===Array.isArray(n[e])&&(n[e]=[]),n[e].push(t),{off:this.off.bind(this,e,t)}},off:function(e,t){e=this._subscribers[e];!1!==Array.isArray(e)&&(t=e.indexOf(t),e.splice(t,1))},trigger:function(e){var t=this._subscribers[e];if(!1!==Array.isArray(t))for(var n,i=[].slice.call(arguments,1),r=0,o=t.length;r<o;r++)"function"==typeof(n=t[r])&&n.apply(null,i)}})}(),function(e,i,t){"use strict";e.inherit("Common.Timer",e.Common.Publisher,function(){var e=this.constructor;if(void 0!==e._instance)return e._instance;this._queue=[],this._isStarted=!1,this._length=0,this._updateCount=0,this._isInitialised=!1,e._instance=this},{UPDATE_INTERVAL:50,set:function(e,t,n){n=n||this._length;t=Math.round(t/this.UPDATE_INTERVAL);return this._length=this._queue.push({key:n,handler:e,timing:1<=t?t:1}),!1===this._isInitialised&&(i.addEventListener("visibilitychange",this._toggleActive.bind(this),!1),this._isInitialised=!0),this._start(),n},remove:function(e){for(var t=this._queue,n=0,i=t.length;n<i;n++)if(t[n].key===e)return t.splice(n,1),this._length--,!0;return!1},_update:function(){var e=this._queue;if(0===e.length)return this._stop(),void(this._updateCount=0);this._updateCount++;for(var t,n=this._updateCount,i=0,r=e.length;i<r;i++)n%(t=e[i]).timing==0&&t.handler();this.trigger("update",this)},_start:function(){if(!0===this._isStarted)return!1;this._isStarted=!0,this._timer=setInterval(this._update.bind(this),this.UPDATE_INTERVAL)},_stop:function(){if(!1===this._isStarted)return!1;clearInterval(this._timer),this._isStarted=!1},_toggleActive:function(){!0===t.hidden?this._stop():this._start()}})}(window.PopIn,window,document),function(n,i){"use strict";n.define("Common.NodeObserver",{DEFAULT_UPDATE_INTERVAL:100,CLASS_NAME_VISIBLE:"visible",targets:[],halfImpTargets:[],_isStarted:!1,_timerKey:null,_subscriber:void 0,_timer:new n.Common.Timer,addTarget:function(e){this.targets.push({node:e.node,onInView:e.onInView,position:e.position||""})},addHalfImpTarget:function(e){this.halfImpTargets.push({node:e.node,onHalfImp:e.onHalfImp})},addTargets:function(e,t){for(var n=0,i=e.length;n<i;n++)this.addTarget({node:e[n],onInView:t})},start:function(){var e=this._timer;!1===this._isStarted&&(this._subscriber=e.on("update",this._onUpdate.bind(this)),this._isStarted=!0),null===this._timerKey&&(this._timerKey=e.set(this._update.bind(this),this.DEFAULT_UPDATE_INTERVAL))},stop:function(){null!==this._timerKey&&(this._timer.remove(this._timerKey),this._timerKey=null)},_update:function(){for(var e,t=this.targets,n=this.halfImpTargets,i=0,r=t.length;i<r;i++){var o,s=(o=t[i]).node;!0===(o.position?this._isVisible(o):this._isVisible(s))&&(s.classList.add(this.CLASS_NAME_VISIBLE),t.splice(i,1),"function"==typeof o.onInView&&o.onInView(s),i--,r--)}for(var a=0,c=n.length;a<c;a++)s=(e=n[a]).node,!0===this._isHalfImp(s)&&(n.splice(a,1),"function"==typeof e.onHalfImp&&e.onHalfImp(s),a--,c--)},_onUpdate:function(){0===this.targets.length&&0===this.halfImpTargets.length&&(this._subscriber.off(),this.stop())},_isVisible:function(e){var t;return e.position?0<(t=e.node.getBoundingClientRect().top)&&i.innerHeight-t>n.Common.Utils.getClientHW().height/3:0<(t=e.getBoundingClientRect().top)&&0<i.innerHeight-t},_isHalfImp:function(e){e=e.getBoundingClientRect().top+(e.getBoundingClientRect().bottom-e.getBoundingClientRect().top)/2;return 0<e&&0<i.innerHeight-e}})}(window.PopIn,window,document),function(n,i,r){"use strict";var o=n.Common,s=o.Utils;n.PROTOCOL;n.inherit("Common.Loader",o.Publisher,function(e){this.target=(e=e||{}).target||r.href,this.apiUrl=e.apiUrl||this.INITIAL_API_URL,0===this.apiUrl.indexOf("http:")&&(this.apiUrl=this.apiUrl.replace("http:","https:")),this.apiUrlAdd=e.apiUrlAdd||"",this.device=e.device||n.DEVICE,this.media=e.media,this.agency=e.agency,this.topn=e.topn||0,this.ad=e.ad||0,this.urlReplace=e.urlReplace,this.useForSzAdLtrRatio=e.useForSzAdLtrRatio,this.infiniteLoadPage=e.infiniteLoadPage,this.useSzAdLtrChannelIdPrefix=e.useSzAdLtrChannelIdPrefix,this.pathnum=e.pathnum,this.needRecommendInformation=e.needRecommendInformation||!1,this.needUserTdInfo=e.needUserTdInfo||!1,this.positionAndStyleObj=null,this.templates=e.templates||[],this.apiHost="",this.country="",this.referrer="",this.requestUrl="",this.popInUserId="",this.userInfo,this.userTdInfo},{INITIAL_API_URL:"https://discoveryplus.popin.cc/popin_discovery/recommend?url=%target",GET_UID_PAGE_URL:"https://api.popin.cc/retarget/uid.html?ac=getuid",SESSION_STORAGE_KEY_UID:"_ss_pp_id",REFFERER_DICTIONARY:{portal_google:/news\.google\.co/,search_yahoo:/search\.yahoo\.co/,sns_facebook:/facebook\.co/,sns_twitter:/twitter\.co|t\.co$/,portal_yahoo:/yahoo\.co/,portal_goo:/goo\.ne/,portal_infoseek:/infoseek\.co/,portal_msn:/msn\.com|www\.msn\.cn/,portal_excite:/excite\.co\.jp/,portal_livedoor:/livedoor\.com/,search_naver:/search\.naver\.com/,sns_naver:/naver\.com|naver\.jp/,sns_hatena:/hatena\.ne\.jp/,portal_aol:/aol\.jp/,search_google:/google\.co/,search_bing:/www\.bing\.com/,portal_biglobe:/www\.biglobe\.ne\.jp/,app_smartnews:/www\.smartnews\.be|www\.smartnews\.com/,app_gunosy:/gunosy\.com/,app_newspicks:/newspicks\.com/,app_antenna:/antenna\.jp/,paid_outbrain:/paid\.outbrain\.com/,paid_yahoo:/trc\.taboola\.com/,paid_logly:/dsp\.logly\.co\.jp/,search_baidu:/www\.baidu\.com/,"search_m-sm":/m\.sm\.cn/,search_so:/www\.so\.com/,search_sogou:/www\.sogou\.com/,"portal_news-baidu":/news\.baidu\.com/,portal_sina:/www\.sina\.com\.cn/,portal_sohu:/www\.sohu\.com/,portal_qq:/www\.qq\.com/,portal_163:/www\.163\.com/,"portal_hao-360":/hao\.360\.cn/,portal_china:/www\.china\.com/,"sns_wechat)":/www\.wechat\.com/,"sns_tieba-baidu":/tieba\.baidu\.com/,sns_weibo:/www\.weibo\.com/,sns_xiaohongshu:/www\.xiaohongshu\.com/},load:function(){var e=this.apiUrl;this.target=this._formatUrl(this.target),this.positionAndStyleObj=this.getPositionAndStyle();var t=e.match(/(jp|tw|kr).popin.cc/);this.country=Array.isArray(t)?t[1]:"",this.apiHost=s.parseUri(e).host.replace("discoveryplus.","jp."),this.userInfo=s.getUserInfo(),this.userTdInfo=!0===this.needUserTdInfo?this._generateUserTdInfo():"",this.popInUserId=n.Common.Uid.getUid(),this.referrer=this._getReferrer(),this.setSzAdLtrByBatch(),!0===this.needRecommendInformation?s.requestByJSONP(this._generateRequestUrl(this.target),this._onResponse.bind(this)):this.trigger("response",this),0<this.templates.length&&(t=((e=this.apiUrl+"&"+this.apiUrlAdd).match(/[\?&]rid=([^&]+)/)||["",""])[1],e=(e.match(/[\?&]alg=([^&]+)/)||["",""])[1],o.rid=t,o.alg=e)},_onResponse:function(e){this._setUid(e.cookie),this.responseData=e,this.trigger("response",this)},_generateRequestUrl:function(e){var t=this.apiUrl.replace(/%target/g,encodeURIComponent(e)),e=navigator.userAgent,e={media:this.media,agency:this.agency,device:this.device,extra:s.getOS(e).toLowerCase(),topn:this.topn,ad:this.ad||void 0,pathnum:this.pathnum,uid:n.Common.Uid.getUid(),info:this.userTdInfo||void 0};return t+"&"+(s.convertObjectToParameterString(e)+this.apiUrlAdd.replace(/\?/,"&"))},_generateUserTdInfo:function(){if(void 0!==this._generateUserTdInfo.userTdInfo)return this._generateUserTdInfo.userTdInfo;var e,t=s.getUserInfo(),n={};for(e in t)n["user_td_"+e]="title"===e?encodeURIComponent(t[e]):t[e];return n.user_device=this.device,n.user_time=o.Global.startTime,n.fruit_box_position=this.positionAndStyleObj.boxPosition,n.fruit_style=this.positionAndStyleObj.adStyleMonitor,this._generateUserTdInfo.userTdInfo=btoa(unescape(encodeURIComponent(JSON.stringify(n))))},_getReferrer:function(){if(""===i.referrer)return"organic";var e,t=this.REFFERER_DICTIONARY,n=s.parseUri(i.referrer).host||"";for(e in t)if(!0===t[e].test(n))return e;return-1<n.indexOf(r.host)?"site":-1<r.href.indexOf("utm_medium=logly")?"paid_logly":"other"},_formatUrl:function(e){return s.replaceAll(e,this.urlReplace)},_setUid:function(e){e&&e.uid&&n.Common.Uid.setUid(e.uid,this.media)},getPositionAndStyle:function(){var e="",t="",n=o.Storage.get("local","_popIn_box_position_style_key_")||"";return(n=n&&JSON.parse(n))&&0<n.length&&(e=n[0].boxPosition||"",t=n[0].adStyleMonitor||""),{boxPosition:e,adStyleMonitor:t}},setSzAdLtrByBatch:function(){"ignore"!==this.useForSzAdLtrRatio&&-1===this.apiUrl.indexOf("&alg=ltr")&&-1===this.apiUrlAdd.indexOf("&alg=ltr")&&("number"==typeof this.useForSzAdLtrRatio?Math.random()<=this.useForSzAdLtrRatio?(this.apiUrl=this.apiUrl+"&alg=ltr",this.appenedAdLtrPrefix()):this.infiniteLoadPage&&this.removeWthSzPrefix():"tw.popin.cc"!=this.apiHost&&"jp.popin.cc"!=this.apiHost||(this.apiUrl=this.apiUrl+"&alg=ltr"))},appenedAdLtrPrefix:function(){for(var e=void 0===this.useSzAdLtrChannelIdPrefix?"":this.useSzAdLtrChannelIdPrefix,t=0;t<this.templates.length;t++){var n=this.templates[t];n.channelId&&0!==n.channelId.indexOf("with_sz_")&&(n.channelId=e+n.channelId)}},removeWthSzPrefix:function(){for(var e=0;e<this.templates.length;e++){var t=this.templates[e];t.channelId&&0===t.channelId.indexOf("with_sz_")&&(t.channelId=(t.channelId.match(/with_sz_(\S*)/)||[t.channelId,t.channelId])[1])}}})}(window.PopIn,(window,document),location),function(){"use strict";(window.PopIn||{}).createClass("Common.Message",function(e){this.country=e||"",this.dictionary=this.DICTIONARY[e.toUpperCase()]||this.DICTIONARY.JP},{DICTIONARY:{JP:{video_button_detail:"詳しくはこちら",video_button_calendar:"カレンダーに登録",video_counter:"再生回数 {{value}}回",video_end_replay:"動画をリプレイ",video_end_detail:"詳しくはこちら",read_debug_container:"本文領域",read_debug_info_view:"本文表示率:{{value}}%",read_debug_info_read:"読了率:{{value}}%",read_debug_info_time:"読む時間:{{value}}秒"},TW:{video_button_detail:"深入了解",video_button_calendar:"カレンダーに登録",video_counter:"觀看次數 {{value}}次",video_end_replay:"再看一次",video_end_detail:"瞭解詳情",read_debug_container:"正文",read_debug_info_view:"正文顯示率:{{value}}%",read_debug_info_read:"正文閱讀率:{{value}}%",read_debug_info_time:"正文閱讀時間:{{value}}秒"}},get:function(e){return this.dictionary[e]}})}(),function(e,t){if(void 0===t[e]){t[e]=function(){t[e].clients.push(this),this._init=[Array.prototype.slice.call(arguments)]},t[e].clients=[];for(var n=["getTrackValues","addRecord","set","trackEvent","trackPageview","trackClicks","ready"],i=0;i<n.length;i++){var r=n[i];t[e].prototype[r]=function(e){return function(){return this["_"+e]=this["_"+e]||[],this["_"+e].push(Array.prototype.slice.call(arguments)),this}}(r)}var o=document.createElement("script");o.type="text/javascript",o.async=!0,o.src=window.PopIn.PROTOCOL+"//api.popin.cc/td_js_sdk_171.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(o,s)}}("Treasure2",window),function(o,i){"use strict";function n(e){this.writeKey=e,this._loggers={}}var r=o.Common.Utils,e=o.PROTOCOL,s={NORMAL_MODE:"normal",OTHER_MODE:"other",NORMAL_MODE_REQUEST_URL:e+"//rlog.popin.cc/s.gif",OTHER_MODE_REQUEST_URL:e+"//r.popin.cc/log.gif",send:function(e,t,n,i){e=e||this.NORMAL_MODE;t=r.convertObjectToParameterString(t),e=this._getRequestPrefix(e);return r.requestByImageBeacon(e+"?"+t,n,i),this},_getRequestPrefix:function(e){switch(e){case this.NORMAL_MODE:return this.NORMAL_MODE_REQUEST_URL;case this.OTHER_MODE:return this.OTHER_MODE_REQUEST_URL}}},a={REQUEST_URL:e+"//inrecsys.popin.cc/PopinService/Logs/",send:function(e,t){t=t||{};t=JSON.stringify(t),t=btoa(unescape(encodeURIComponent(t)));r.requestByImageBeacon(this.REQUEST_URL+e+"?data="+t)}};(t=n.prototype).open=function(e,t){var n=new i.Treasure2({writeKey:this.writeKey,database:e});n.set("$global","td_global_id","td_global_id"),this._loggers[e]=n,"function"==typeof t&&n.ready(t)},t.ready=function(e,t){this._loggers[e].ready(t)},t.getTrackValues=function(e){return this._loggers[e].getTrackValues()},t.send=function(e,t,n,i,r){return"popin_media"===e&&"discoverylogs"===t?this.sendUts(e,t,n):(this.sendTd(e,t,n,i,r),"popin_ads"===e&&"adlogs"===t&&this.sendUts(e,t,n)),this},t.sendTd=function(e,t,n,i,r){return this._loggers[e].addRecord(t,n,function(){"function"==typeof i&&i()},function(){"function"==typeof r&&r()}),this},t.sendUts=function(e,t,n){var i=r.getUserInfo();n.td_os=i.os,n.td_os_version=i.os_version,n.td_browser=i.browser,n.td_browser_version=i.browser_version,delete n.td_ip;n=JSON.stringify(n),n=["https://log.popin.cc/log","/"+e,"/"+t,"?data="+btoa(unescape(encodeURIComponent(n))),"&t="+(new Date).getTime()].join("");(new Image).src=n};var t,e=function(){var e=this.constructor;if(void 0!==e._instance)return e._instance;this.isReady=!1,this.basic=s;var t=new n(this.TD_WRITE_KEY);t.open(this.DB_NAME_DISCOVERY_LOG),t.open(this.DB_NAME_AD,this._onReadyTreasure.bind(this,t)),this.treasure=t,this.inrecsys=a,this._sendLog={basic:this._sendBasicLog.bind(this),treasure:this._sendTreasureLog.bind(this),inrecsys:this._sendInrecsysLog.bind(this)},i.addEventListener("touchstart",this._recordUserInteraction,!1),i.addEventListener("click",this._recordUserInteraction,!1),i.addEventListener("mousedown",this._recordUserInteraction,!1),e._alreadyOutputData=[],e._interactionNumber=0,e._lastEvent=!1,e._instance=this};(t=e.prototype).TD_WRITE_KEY="8378/25839e06ce4cc1cab55c1c1f1e49d336d6d1d48f",t.DB_NAME_DISCOVERY_LOG="popin_media",t.DB_NAME_AD="popin_ads",t.send=function(e,t){t=t||{};var n=this._sendLog[e];"function"==typeof n&&!0===this._isValid(e,t)&&n(t)},t.getTrackValues=function(){return this.trackValues||null},t.setTzValue=function(e,t){if(e&&"normal"!==e)return t;var n,i={r1:/.*/,type:/(pc|mobile)_viewall/},r=!1;for(n in i)if(t[n]&&i[n].test(t[n])){r=!0;break}return r||(t.tz=o.REQUEST_COUNTRY),t},t.ready=function(e){!0===this.isReady?e():this.treasure.ready(this.DB_NAME_AD,e)},t._onReadyTreasure=function(e){this.isReady=!0,this.trackValues=e.getTrackValues(this.DB_NAME_AD)},t._sendBasicLog=function(e){var t=(e=e||{}).data||{};t.t=Date.now(),t=this.setTzValue(e.mode,t),this.basic.send(e.mode,t,e.onComplete,e.onError)},t._sendTreasureLog=function(e){var t=(e=e||{}).data||{};t.popin_version=o.VERSION,t.interaction_number=this.constructor._interactionNumber;var n,i=this._lastEvent;i&&(i.touches&&(n=i.touches[0],t.interaction_touchx=Math.round(n.pageX),t.interaction_touchy=Math.round(n.pageY)),"mousedown"===i.type&&(t.interaction_mousex=Math.round(i.pageX),t.interaction_mousey=Math.round(i.pageY))),this.treasure.send(e.db,e.table,t,e.onComplete,e.onError)},t._sendInrecsysLog=function(e){var t=(e=e||{}).data||{};t.now=Date.now(),t.popin_version=o.VERSION,this.inrecsys.send(e.api,t)},t._recordUserInteraction=function(e){var t=this.constructor;t._interactionNumber++,t._lastEvent=e},t._isValid=function(e,t){t=t.uniqueId;if("string"==typeof t){e=e+"|"+t,t=this.constructor._alreadyOutputData;if(!0===r.includes(e,t))return!1;t.push(e)}return!0};var c=new e;c.ready(function(){o.define("Common.Logger",c)})}(window.PopIn,window),function(e){"use strict";e.define("Common.Global",{startTime:Date.now(),expectedAndRenderAds:{}})}(window.PopIn,window),function(t,n){"use strict";t.createClass("Common.Messenger",function(e){this.url=(e=e||{}).url,this._iframeNode},{setup:function(){var e=t.Common.Utils.createIFrameObject(this.url).element;n.body.appendChild(e),this._iframeNode=e},send:function(e){this._iframeNode.contentWindow.postMessage(JSON.stringify(e),"*")}})}(window.PopIn,(window,document));